# [サブシステム名] Subsystem

**解析日**: YYYY-MM-DD
**解析者**: legacy-analyzer-agent
**対象ディレクトリ**: legacy/src/[サブシステム]/
**制作者確認**: [ ] 未確認 / [ ] 確認済み

---

## 概要

[このサブシステムが何をするかを1-2文で説明]

例:
ゲームロジックサブシステムは、ゲーム全体の状態管理、イベント処理、ゲームルールの実装を担当します。

**制作者による補完**:
- （例: 「このサブシステムが最も複雑で、開発時間の半分を費やした」）

---

## 主要クラス

| クラス名 | ファイル | 役割 | 行数 |
|---------|---------|------|------|
| [Class1] | [File1].cpp | [役割] | XXX |
| [Class2] | [File2].cpp | [役割] | XXX |
| [Class3] | [File3].cpp | [役割] | XXX |

---

## クラス詳細

### [Class1]

**役割**:
[このクラスが担当する責務を説明]

**メンバー変数**（Serena MCPで取得）:
```cpp
class [Class1] {
private:
    // 主要なメンバー変数
    Type1 member1;  // 説明
    Type2 member2;  // 説明
    // ...
};
```

**主要メソッド**:

#### `methodName1()`

**参照**: legacy/src/[path]/[file].cpp:XX

**処理の流れ**（コードから推測）:
1. [ステップ1]
2. [ステップ2]
3. [ステップ3]

**確認事項**:
- [ ] この処理の意図は何ですか？
- [ ] 特殊なケースの処理はありますか？

**制作者による補完**:
- （例: 「この関数は〇〇のために作った」）
- （例: 「エッジケースとして△△を考慮している」）

#### `methodName2()`

**参照**: legacy/src/[path]/[file].cpp:YY

**処理の流れ**（コードから推測）:
1. [ステップ1]
2. [ステップ2]

**確認事項**:
- [ ] なぜこのような実装にしましたか？

**制作者による補完**:
- （例: 「当時はこれがベストな方法だと思った」）

---

### [Class2]

（同様の形式で記述）

---

## 処理フロー

### 全体フロー

```
[EntryPoint]
  ↓
[Process1]
  ↓
[Process2]
  ├─ [SubProcess2-1]
  └─ [SubProcess2-2]
  ↓
[Process3]
```

**確認事項**:
- [ ] このフローは正しいですか？
- [ ] 重要な分岐が抜けていませんか？

**制作者による補完**:
- （例: 「[SubProcess2-3] が抜けている」）

---

### 詳細フロー（重要な処理）

#### [重要な処理名]

**参照**: legacy/src/[path]/[file].cpp:ZZ

**フローチャート**:
```
Start
  ↓
条件判定A
  ├─ YES → [処理A]
  └─ NO  → [処理B]
  ↓
条件判定B
  ↓
End
```

**コード抜粋**（Serena MCPで取得）:
```cpp
void importantFunction() {
    if (conditionA) {
        // 処理A
        processA();
    } else {
        // 処理B
        processB();
    }

    if (conditionB) {
        // ...
    }
}
```

**確認事項**:
- [ ] conditionA/B の条件は何ですか？
- [ ] この処理で考慮していた特殊なケースは？

**制作者による補完**:
- （例: 「conditionAは〇〇の状態をチェックしている」）

---

## データ構造

### [データ構造名]

**目的**:
[なぜこのデータ構造を使ったか]

**定義**（Serena MCPで取得）:
```cpp
struct [StructName] {
    Type1 field1;  // 説明
    Type2 field2;  // 説明
    // ...
};
```

**使用箇所**:
- [Class1]::[Method1]
- [Class2]::[Method2]

**確認事項**:
- [ ] このデータ構造で不足していた点は？
- [ ] 将来的に拡張する予定でしたか？

**制作者による補完**:
- （例: 「field3 を追加したかったが時間がなかった」）

---

## 状態管理

### ステートマシン

このサブシステムは以下の状態を持ちます（推測）:

| 状態 | 説明 | 遷移条件 |
|------|------|---------|
| STATE_A | [説明] | [条件] → STATE_B |
| STATE_B | [説明] | [条件] → STATE_C |
| STATE_C | [説明] | [条件] → STATE_A |

**状態遷移図**:
```
STATE_A ─[条件1]→ STATE_B
   ↑                ↓
   └────STATE_C ←──┘
         [条件2]
```

**確認事項**:
- [ ] 状態の種類は正しいですか？
- [ ] 遷移条件を教えてください

**制作者による補完**:
- （例: 「STATE_Dもあった。特定のイベント時のみ」）

---

## イベント処理

### イベントの種類

| イベント名 | トリガー | 処理内容 |
|-----------|---------|---------|
| EVENT_A | [トリガー] | [処理] |
| EVENT_B | [トリガー] | [処理] |
| EVENT_C | [トリガー] | [処理] |

**イベントフロー**:
```
[Event発生]
  ↓
EventManager::dispatch()
  ↓
該当するListener::handle()
  ↓
[処理実行]
```

**確認事項**:
- [ ] イベントの優先順位はありましたか？
- [ ] イベントキューの仕組みは？

**制作者による補完**:
- （例: 「イベントは即座に処理。キューは使っていない」）

---

## 依存関係

### このサブシステムが依存するもの

- [Other Subsystem 1]: [理由]
- [Other Subsystem 2]: [理由]
- [External Library]: [理由]

### このサブシステムに依存するもの

- [Dependent Subsystem 1]: [理由]
- [Dependent Subsystem 2]: [理由]

**確認事項**:
- [ ] 依存関係で問題になった点は？
- [ ] 循環依存はありましたか？

**制作者による補完**:
- （例: 「〇〇と△△で循環依存があり、リファクタリングしたかった」）

---

## アルゴリズム（重要な処理のみ）

### [アルゴリズム名]

**目的**:
[このアルゴリズムが何を解決するか]

**コード**（Serena MCPで取得）:
```cpp
// legacy/src/[path]/[file].cpp:XXX
ReturnType algorithmName(Param param) {
    // アルゴリズムの実装
    // ...
}
```

**処理の説明**:
1. [ステップ1の説明]
2. [ステップ2の説明]
3. [ステップ3の説明]

**計算量**:
- 時間計算量: O(?)（推測）
- 空間計算量: O(?)（推測）

**確認事項**:
- [ ] このアルゴリズムの選択理由は？
- [ ] パフォーマンスの問題はありましたか？

**制作者による補完**:
- （例: 「当時は効率を考えずに実装した。改善の余地あり」）

---

## 既知の問題・バグ

### バグ1: [バグの名前]

**症状**:
[どのような問題が発生するか]

**原因**（推測/確認）:
[コードのどの部分に問題があるか]

**再現条件**:
- [条件1]
- [条件2]

**制作者による補完**:
- （例: 「このバグは知っていたが修正できなかった」）
- （例: 「実は仕様だった」）

---

## 改善案

### 制作者の反省点

- （例: 「クラスが大きすぎた。分割すべきだった」）
- （例: 「エラーハンドリングが不十分」）
- （例: 「テストコードを書くべきだった」）

### 新規実装での改善方針

- （例: 「状態管理をより明確に」）
- （例: 「イベントシステムを汎用化」）
- （例: 「ユニットテストを追加」）

---

## Phase 3 での詳細解析が必要な箇所

- [ ] [アルゴリズム1]：特に複雑で重要
- [ ] [アルゴリズム2]：パフォーマンスに影響
- [ ] [処理3]：バグが多発した箇所

---

## メモ

**解析中の気づき**:
- （例: コメントが少なく、意図の推測が難しい）
- （例: マジックナンバーが多い）

**制作者のメモ**:
- （例: 当時は時間がなく、雑な実装になった）
- （例: このサブシステムは後で全面的に書き直したかった）

---

## 参照

- [Overview](../overview.md)
- [ディレクトリ構造](../architecture/directories.md)
- [主要クラス一覧](../data/classes.md)
- [他のサブシステム](./other-subsystem.md)
