# [データ構造名] Data Structure

**解析日**: YYYY-MM-DD
**解析者**: legacy-analyzer-agent
**対象ファイル**: legacy/src/data/[ファイル名].h/cpp
**制作者確認**: [ ] 未確認 / [ ] 確認済み

---

## 概要

[このデータ構造が何を表現するかを説明]

例:
Playerデータ構造は、プレイヤーキャラクターの全ての状態（HP、レベル、所持アイテム等）を保持します。

**制作者による補完**:
- （例: 「当初はもっとシンプルだったが、機能追加で肥大化した」）

---

## 定義

### クラス/構造体の定義

**参照**: legacy/src/data/[ファイル名].h:XX

**完全な定義**（Serena MCPで取得）:
```cpp
class [ClassName] {
public:
    // コンストラクタ
    [ClassName]();
    ~[ClassName]();

    // 公開メソッド
    ReturnType publicMethod1();
    ReturnType publicMethod2();

private:
    // メンバー変数
    Type1 member1;  // 説明
    Type2 member2;  // 説明
    Type3 member3;  // 説明
    // ...
};
```

---

## メンバー変数の詳細

| 変数名 | 型 | 役割 | デフォルト値 | 範囲/制約 |
|-------|-----|------|------------|---------|
| member1 | Type1 | [役割] | [値] | [範囲] |
| member2 | Type2 | [役割] | [値] | [範囲] |
| member3 | Type3 | [役割] | [値] | [範囲] |

### member1

**役割**:
[この変数が何を表現するか]

**使用箇所**:
- [Method1]で参照
- [Method2]で更新

**確認事項**:
- [ ] この変数の意味は何ですか？
- [ ] 値の範囲に制約はありますか？

**制作者による補完**:
- （例: 「この変数は〇〇を表す。0〜100の範囲」）

---

### member2

（同様の形式で記述）

---

## メソッドの詳細

### publicMethod1()

**参照**: legacy/src/data/[ファイル名].cpp:YY

**シグネチャ**:
```cpp
ReturnType publicMethod1(ParamType param);
```

**目的**:
[このメソッドが何をするか]

**処理の流れ**:
1. [ステップ1]
2. [ステップ2]
3. [ステップ3]

**コード抜粋**（Serena MCPで取得）:
```cpp
ReturnType ClassName::publicMethod1(ParamType param) {
    // 実装の抜粋
    // ...
}
```

**確認事項**:
- [ ] このメソッドの意図は何ですか？
- [ ] 副作用はありますか？

**制作者による補完**:
- （例: 「このメソッドは〇〇のために作った」）

---

### publicMethod2()

（同様の形式で記述）

---

## データの初期化

### コンストラクタ

**参照**: legacy/src/data/[ファイル名].cpp:ZZ

**コード**（Serena MCPで取得）:
```cpp
ClassName::ClassName()
    : member1(defaultValue1)
    , member2(defaultValue2)
{
    // 初期化処理
}
```

**初期化の流れ**:
1. [ステップ1]
2. [ステップ2]

**確認事項**:
- [ ] デフォルト値の根拠は？
- [ ] 初期化で特に注意していた点は？

**制作者による補完**:
- （例: 「member1のデフォルト値は試行錯誤で決めた」）

---

## データの永続化

### 保存形式

**形式**: バイナリ / テキスト / XML / JSON / その他

**ファイル構造**（推測）:
```
[ファイル形式の説明]

例（バイナリの場合）:
Offset  Size  Field
0x00    4     member1 (int)
0x04    4     member2 (int)
0x08    ?     member3 (string)
```

**確認事項**:
- [ ] 保存形式の選択理由は？
- [ ] バージョニングは考慮していましたか？

**制作者による補完**:
- （例: 「独自バイナリ形式。互換性は考えていなかった」）

---

### 保存処理

**参照**: legacy/src/data/[ファイル名].cpp:WW

**コード抜粋**（Serena MCPで取得）:
```cpp
void ClassName::save(const string& filename) {
    // 保存処理
}
```

**処理の流れ**:
1. [ステップ1]
2. [ステップ2]

**確認事項**:
- [ ] エラーハンドリングはどうしていましたか？
- [ ] 破損したデータの対処は？

---

### 読み込み処理

**参照**: legacy/src/data/[ファイル名].cpp:VV

**コード抜粋**（Serena MCPで取得）:
```cpp
bool ClassName::load(const string& filename) {
    // 読み込み処理
}
```

**処理の流れ**:
1. [ステップ1]
2. [ステップ2]

**確認事項**:
- [ ] 読み込み失敗時の挙動は？
- [ ] バージョン違いのデータは読めましたか？

**制作者による補完**:
- （例: 「読み込み失敗時はデフォルト値で初期化」）

---

## データの検証

### バリデーション

**実装箇所**: [Method名] / 未実装

**検証内容**（推測/確認）:
- [ ] member1の範囲チェック
- [ ] member2の null チェック
- [ ] member3の整合性チェック

**確認事項**:
- [ ] バリデーションは実装していましたか？
- [ ] 不正なデータの対処は？

**制作者による補完**:
- （例: 「バリデーションは不十分。バグの原因になった」）

---

## データの使用例

### 典型的な使用パターン

**パターン1: 生成と初期化**
```cpp
// 使用例（推測）
ClassName* obj = new ClassName();
obj->initialize(param);
```

**パターン2: 更新**
```cpp
// 使用例（推測）
obj->update(deltaTime);
obj->publicMethod1(value);
```

**パターン3: 保存と読み込み**
```cpp
// 使用例（推測）
obj->save("data.dat");
// ...
obj->load("data.dat");
```

**確認事項**:
- [ ] 典型的な使用方法は？
- [ ] 注意すべきアンチパターンは？

**制作者による補完**:
- （例: 「update()の呼び出しを忘れるとバグになる」）

---

## メモリ管理

### 所有権

**所有者**: [どのクラスが所有するか]

**生成**:
- 生成箇所: [Class]::[Method]
- 生成方法: new / スタック / その他

**破棄**:
- 破棄箇所: [Class]::[Method]
- 破棄方法: delete / 自動 / その他

**確認事項**:
- [ ] メモリリークの問題はありましたか？
- [ ] 二重deleteのバグは？

**制作者による補完**:
- （例: 「所有権が曖昧で、メモリリークがあった」）

---

## 継承関係

### 基底クラス

**基底クラス**: [ClassName] / なし

**継承理由**:
[なぜ継承を使ったか]

**オーバーライドしているメソッド**:
- `virtualMethod1()`: [理由]
- `virtualMethod2()`: [理由]

**確認事項**:
- [ ] 継承構造の設計意図は？
- [ ] 多重継承は使っていましたか？

**制作者による補完**:
- （例: 「継承は使わなくてもよかったかもしれない」）

---

### 派生クラス

**派生クラス**: [DerivedClassName1], [DerivedClassName2]

**派生の理由**:
[なぜ派生させたか]

**追加されたメンバー**:
- [DerivedClassName1]: member4, member5
- [DerivedClassName2]: member6

---

## パフォーマンス

### サイズ

**推定サイズ**: sizeof([ClassName]) = XX bytes

**内訳**:
- member1: 4 bytes
- member2: 8 bytes
- member3: ?? bytes（可変）

**確認事項**:
- [ ] メモリ使用量は問題になりましたか？
- [ ] パディングを考慮していましたか？

**制作者による補完**:
- （例: 「サイズは気にしていなかった」）

---

### コピーのコスト

**コピーコンストラクタ**: 実装済み / 未実装 / デフォルト

**コピーのコスト**: O(?)

**確認事項**:
- [ ] ディープコピーが必要でしたか？
- [ ] コピーのパフォーマンス問題は？

**制作者による補完**:
- （例: 「ポインタのメンバーがあり、ディープコピーが必要だった」）

---

## 既知の問題

### 問題1: [問題の名前]

**症状**:
[どのような問題が発生するか]

**原因**:
[このデータ構造のどこに問題があるか]

**制作者による補完**:
- （例: 「member3が nullになることがあり、クラッシュした」）

---

## 改善案

### 設計の反省点

**制作者による評価**:
- （例: 「肥大化しすぎた。分割すべきだった」）
- （例: 「不変条件の保証が弱い」）

### 新規実装での改善方針

- （例: 「値オブジェクトとして再設計」）
- （例: 「イミュータブルにする」）
- （例: 「JSON形式で保存」）

---

## 関連データ構造

| データ構造 | 関係 | 説明 |
|-----------|------|------|
| [RelatedClass1] | 参照 | [説明] |
| [RelatedClass2] | 集約 | [説明] |
| [RelatedClass3] | 依存 | [説明] |

---

## メモ

**解析中の気づき**:
- （例: メンバー変数が多すぎて把握が困難）

**制作者のメモ**:
- （例: 当時は設計を考えずに追加していった）

---

## 参照

- [Overview](../overview.md)
- [サブシステム](./subsystem.md)
- [関連データ構造](./related-data.md)
