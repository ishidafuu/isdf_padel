# 推敲の進め方

このドキュメントでは、フレームワークの推敲をどのように進めるかを説明します。

---

## 基本方針

### やること

✅ **フレームワーク設計の改善**
- エージェント定義の精緻化
- 仕様書テンプレートの改善
- ワークフローの検証
- ドキュメントの整備
- 矛盾・曖昧さの解消

✅ **変更の記録**
- Git で変更を追跡
- CHANGELOG.md に変更内容を記録
- コミットメッセージで意図を明確に

### やらないこと

❌ **実装**
- ゲームのコード実装
- 実プロジェクトへの展開
- 動作検証用のコード作成

❌ **範囲外の拡張**
- 新しいゲームジャンルへの対応
- 3D対応
- 新エンジン対応

---

## 推敲のワークフロー

### 1. 課題を発見する

```
推敲中に気づいた問題点：
- 「このエージェントの責務が曖昧」
- 「この記述が矛盾している」
- 「このフローにエッジケースがある」
```

### 2. 変更を行う

```bash
# ファイルを編集
# （Claude Code で直接編集可能）

# 変更をコミット
git add -A
git commit -m "fix: spec-agent の入力定義を明確化

- 要件サマリの必須フィールドを定義
- オプショナルな引き継ぎデータを追記"
```

### 3. CHANGELOG.md に記録

```markdown
## [Unreleased]

### Changed
- spec-agent の入力定義を明確化
  - 要件サマリの必須フィールドを定義
  - オプショナルな引き継ぎデータを追記
```

---

## コミットメッセージの規約

### フォーマット

```
<type>: <subject>

<body>
```

### Type

| Type | 用途 |
|------|------|
| `fix` | 矛盾・問題の修正 |
| `refine` | 記述の精緻化・改善 |
| `clarify` | 曖昧な記述の明確化 |
| `add` | 新しい定義・ルールの追加 |
| `remove` | 不要な記述の削除 |
| `docs` | ドキュメントの改善 |
| `structure` | ファイル構成の変更 |

### 例

```
fix: critic-agent と review-agent の責務境界を明確化

- critic-agent: 仕様の「内容」を批評（矛盾、曖昧さ、漏れ）
- review-agent: 仕様書の「形式」を検証（ID重複、参照切れ）
```

```
clarify: 番号体系のサブフォルダ制約を明記

- サブフォルダ番号 00 は親フォルダ直下ファイル用に予約
- 300_xxx/ のようなフォルダは作成禁止
```

---

## 推敲の観点

### エージェント設計

| 観点 | 確認事項 |
|------|----------|
| 責務 | 各エージェントの役割は明確か |
| 境界 | エージェント間の責務重複はないか |
| 入出力 | 入力・出力の定義は十分か |
| 連携 | エージェント間の連携フローは自然か |
| エラー | 問題発見時の対応は定義されているか |

### 仕様書体系

| 観点 | 確認事項 |
|------|----------|
| 番号 | 番号体系は一貫しているか |
| ID | ID管理ルールは明確か |
| 参照 | 相互参照の方法は定義されているか |
| テンプレート | テンプレートは使いやすいか |

### ワークフロー

| 観点 | 確認事項 |
|------|----------|
| パターン | 開発パターン（A〜E）は網羅的か |
| 順序 | 各フェーズの順序は適切か |
| 分岐 | 条件分岐は明確か |
| 復帰 | エラー時の復帰手順は定義されているか |

### ドキュメント

| 観点 | 確認事項 |
|------|----------|
| 用語 | 用語の定義は一貫しているか |
| 説明 | 説明は分かりやすいか |
| 例 | 具体例は十分か |
| 導線 | ドキュメント間の導線は適切か |

---

## Claude Code での推敲

### 推奨ワークフロー

```bash
# 1. Claude Code を起動
claude

# 2. 推敲を依頼
> spec-agent の定義を読んで、曖昧な点を指摘して

# 3. 指摘に基づいて修正を依頼
> その指摘を踏まえて、入力定義を明確化して

# 4. 変更をコミット
> 変更をコミットして
```

### 推敲の依頼例

```
# 全体レビュー
「agents/ 内の全エージェントをレビューして、責務の重複や曖昧さを指摘して」

# 特定エージェントの精緻化
「critic-agent の出力フォーマットをより具体的に定義して」

# ワークフロー検証
「パターンA（新機能開発）のフローで、考慮漏れがないか確認して」

# 矛盾チェック
「spec.md と users-guide.md で矛盾している記述がないか確認して」
```

---

## マイルストーン

### v2.16-draft → v2.16-rc1

以下が完了したら `v2.16-rc1` としてタグを打つ：

- [ ] 全エージェント定義のレビュー完了
- [ ] 責務境界の明確化
- [ ] 入出力定義の精緻化
- [ ] ワークフローの検証
- [ ] ドキュメント間の整合性確認

### v2.16-rc1 → v2.16

以下が完了したら `v2.16` としてタグを打つ：

- [ ] 小規模な実プロジェクトでの検証
- [ ] templates/ の整備
- [ ] 導入手順の確定
- [ ] 最終レビュー

---

## 質問・議論

推敲中に判断に迷う点があれば、以下の形式でコメントを残す：

```markdown
<!-- DISCUSSION:
Q: critic-agent は design.md も批評対象にすべきか？
A: （未決定）
-->
```

後でまとめて検討する。
