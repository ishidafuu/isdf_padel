# コマンド一覧

仕様書駆動開発フレームワークのスラッシュコマンド。

---

## 設計思想

### コマンドの2分類

スラッシュコマンドは **使用者** によって2種類に分かれる:

| 分類 | 使用者 | 例 |
|------|--------|-----|
| **自動実行用** | Claude Code（メイン） | `/id-next`, `/docs-validate`, `/deps-check` |
| **人間専用** | ユーザー | `/handover`, `/resume-handover` |

### 自動実行用コマンドの動作

```
┌──────────────────────────────────────┐
│  人間: 意図を伝える                   │
│  「プレイヤーの仕様を作って」         │
└─────────────┬────────────────────────┘
              │
              ▼
┌──────────────────────────────────────┐
│  Claude Code: 自律的にコマンドを使う  │
│  • /id-next で自動採番               │
│  • /docs-validate で自動検証         │
│  • /deps-check で自動チェック        │
└─────────────┬────────────────────────┘
              │
              ▼
┌──────────────────────────────────────┐
│  結果: 整合性が保たれた仕様書         │
└──────────────────────────────────────┘
```

**原則**:
- **自動実行用**: 人間は直接使わない。Claude Code が自動的に使う。
- **人間専用**: ユーザーが明示的に入力して使う。

---

## 使用者別一覧

### 🧑 人間専用コマンド（2個）

プロジェクトの状況確認に使用。エージェントは**呼び出さない**。

| コマンド | 説明 | 使用タイミング |
|---------|------|--------------|
| `/handover [--task <id>]` | タスクファイルに引き継ぎ情報を記録 | セッション終了前 |
| `/resume-handover [--task <id>]` | タスクファイルからセッションを再開 | セッション開始時 |

**推奨される使い方**:
```bash
# セッション開始時に前回の作業を再開
/resume-handover

# タスク指定で再開
/resume-handover --task 30101

# セッション終了前に引き継ぎを作成
/handover

# タスク指定で引き継ぎを作成
/handover --task 30101
```

---

### 🤖 エージェント専用コマンド（8個）

エージェントが**自動的に使う**コマンド。人間は直接使わない。

#### ID管理（spec/design/behavior/test-agent）

| コマンド | 使用エージェント | 自動実行タイミング | 説明 |
|---------|----------------|------------------|------|
| `/id-next <TYPE-FILE>` | spec/design/behavior/test-agent | ID採番時 | 次の連番を自動取得 |
| `/id-list <FILE>` | 全エージェント | ID確認時 | 既存IDの一覧 |

**例（spec-agentが自動実行）**:
```bash
# spec-agent が内部的に実行
/id-next REQ-30101
→ 次のID: REQ-30101-005

# この結果を使って仕様書に記載
REQ-30101-005: ジャンプ機能
```

#### 検証コマンド（review/critic/deps/data-agent）

| コマンド | 使用エージェント | 自動実行タイミング | 説明 |
|---------|----------------|------------------|------|
| `/docs-validate` | review-agent | 批評開始時 | 整合性の自動検証 |
| `/deps-check` | deps-agent, review-agent | 仕様書変更後 | 依存関係チェック |
| `/impl-validate` | review-agent | 実装後 | 仕様書にない実装を検出 |
| `/ears-validate` | critic-agent | spec.md作成後 | 曖昧な表現を検出 |
| `/data-validate` | data-agent, review-agent | データ変更後 | データとコードの整合性 |

**例（review-agentが自動実行）**:
```bash
# review-agent がレビュー開始時に自動実行
/docs-validate --file 30101
→ [PASS] ID重複なし
→ [FAIL] REQ-30101-003 に対応する TST が存在しません

/deps-check
→ [PASS] 禁止依存なし
→ [WARN] 302_enemy が 301_player を参照しています
```

#### 依存関係管理（deps-agent）

| コマンド | 使用エージェント | 自動実行タイミング | 説明 |
|---------|----------------|------------------|------|
| `/deps-graph` | deps-agent | dependencies.md更新後 | Mermaid図の自動生成 |

---

### 🔀 共用コマンド（4個）

状況に応じて人間またはエージェントが使用。

| コマンド | 人間の用途 | エージェントの用途 |
|---------|----------|-----------------|
| `/id <ID>` | デバッグ目的でID定義箇所を確認 | エスカレーション時にIDの存在確認 |
| `/id-refs <ID>` | IDの影響範囲を調査 | リファクタリング時に参照箇所を確認 |
| `/component-share` | Component共有化の判断 | design-agentが自動実行 |
| `/task-next [--limit <N>]` | 次に着手可能なタスクを確認 | タスク完了時に自動実行 |

---

## エージェントの自動実行フロー

### spec-agent の例

```
ユーザー: 「プレイヤーの仕様を作って」
  ↓
spec-agent:
  1. /id-next REQ-30101 を自動実行
     → REQ-30101-005 を取得
  2. spec.md を作成
  3. /docs-validate --file 30101 を自動実行
     → 整合性確認
  4. 問題があれば自動修正またはユーザーに報告
  ↓
ユーザー: （何もしない、結果を確認するのみ）
```

### review-agent の例

```
ユーザー: 「仕様書をレビューして」
  ↓
review-agent:
  1. /docs-validate を自動実行
     → ID重複、参照エラーを検出
  2. /deps-check を自動実行
     → 禁止依存、循環依存を検出
  3. /impl-validate を自動実行（実装がある場合）
     → 仕様書にない実装を検出
  4. レポートを生成
  ↓
ユーザー: レポートを確認
```

---

## コマンド間の依存関係

```
/component-share
├── /id-next      # 新しいファイル番号を取得
├── /id-refs      # 参照元を検索
├── /deps-graph   # 依存図を再生成
├── /deps-check   # 依存関係を確認
└── /docs-validate # 整合性を確認

/id-next
└── /id-list      # ID衝突確認（ブランチ並行作業時）
```

---

## 共通オプション

### `--include-deprecated`

`_deprecated/` 内のファイルも対象に含める。

対応コマンド:
- `/id`
- `/id-list`
- `/id-refs`
- `/docs-validate`
- `/deps-check`

---

## 終了コード

全コマンド共通:

| コード | 意味 |
|--------|------|
| 0 | 正常終了 |
| 1 | エラーまたは問題検出 |

---

## 並列セッション管理

並列セッション管理は session-manager-agent ガイドラインに従って Claude Code が自動実行します。
詳細は `agents/session-manager-agent.md` および `skills/parallel-sessions.md` を参照。

### セッション管理コマンド（3個）

| コマンド | 説明 | 使用タイミング |
|---------|------|--------------|
| `/session-init` | 並列セッションの初期化（worktree作成、ブランチ作成） | 並列実装開始時 |
| `/session-status` | セッション状況確認（アクティブセッション、ID予約状況） | 状態確認時 |
| `/session-merge` | セッションマージ（競合検出、推奨順序提案） | マージ時 |

### ID予約コマンド（5個）

並列セッション時のID衝突を防ぐ:

| コマンド | 説明 |
|---------|------|
| `/id-reserve` | ID範囲を予約 |
| `/id-reserve-status` | 予約状況一覧表示 |
| `/id-reserve-release` | 予約解放 |
| `/id-reserve-extend` | 予約期限延長 |
| `/id-reserve-cleanup` | 期限切れ予約削除 |

**ユーザーが使う指示**:
- 「Player、Enemy、Stageを並列実装したい」- 並列セッション開始
- 「セッション状態を確認して」- 状態確認
- 「セッションをマージしたい」- マージ調整

---

## 関連ドキュメント

- `docs/reference/framework-spec.md` - フレームワーク仕様書（番号体系セクション）
- `skills/task-workflow.md` - Markdownタスク管理
- `agents/*.md` - 各エージェントの定義（使用コマンドの詳細）
