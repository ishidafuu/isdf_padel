---
description: 次の連番IDを取得
argument-hint: <種別>-<ファイル番号>
---

# /id-next コマンド

指定された種別・ファイル番号の次の連番IDを取得します。

**引数**: $ARGUMENTS

## 使用者

**🤖 エージェント専用コマンド** - 人間は直接使わない

### 使用エージェント

| エージェント | ID種別 | 使用タイミング |
|------------|--------|--------------|
| spec-agent | REQ-xxxxx | 新しい要件追加時 |
| design-agent | DES-xxxxx | 新しいComponent追加時 |
| behavior-agent | BHV-xxxxx | 新しいSystem追加時 |
| test-agent | TST-xxxxx | 新しいテストケース追加時 |
| task-registration-agent | FXXX/30XXX/PXXX | タスク登録時 |

**自動実行**: エージェントが ID 採番時に自動的に実行

## 使用方法

### 仕様書ID採番

```
/id-next REQ-30101    # → REQ-30101-005（既存が001-004の場合）
/id-next DES-30102    # → DES-30102-001（既存がない場合）
/id-next TST-30105    # → TST-30105-010（既存が001-009の場合）
```

### タスクID採番

```
/id-next FXXX         # → F012（フレームワークタスク、既存がF001-F011の場合）
/id-next 30XXX        # → 30102（ゲーム開発タスク、既存が30100-30101の場合）
/id-next PXXX         # → P003（プロジェクト横断タスク、既存がP001-P002の場合）
```

## 指示

引数（`$ARGUMENTS`）に応じて、次のIDを計算します。

### 仕様書ID採番の場合

引数が `REQ-30101` のような形式の場合:

1. 指定された種別とファイル番号から対象ファイルを特定
2. 既存のIDを全て抽出
3. 最大の連番 + 1 を計算
4. 以下の形式で出力:

```
次のID: REQ-30101-005

既存ID:
- REQ-30101-001
- REQ-30101-002
- REQ-30101-003
- REQ-30101-004
```

### タスクID採番の場合

引数が `FXXX`, `30XXX`, `PXXX` のような形式の場合:

1. タスクタイプを判定:
   - `FXXX` → framework（検索: `tasks/**/*.md`）
   - `30XXX` → game-dev（検索: `project/tasks/**/*.md` で30で始まるファイル）
   - `PXXX` → project-wide（検索: `project/tasks/**/*.md` でPで始まるファイル）

2. 既存のタスクファイルからIDを抽出

3. 最大のID番号 + 1 を計算

4. 以下の形式で出力:

```
次のID: F012

既存タスクID:
- F001
- F002
- ...
- F011
```

## ID形式

### 仕様書ID形式

```
[種別]-[ファイル番号]-[連番3桁]

例: REQ-30101-001
    ├── REQ: 種別（要件）
    ├── 30101: ファイル番号
    └── 001: 連番
```

| 種別 | ファイル |
|------|----------|
| REQ | *_spec.md |
| DES | *_design.md |
| BHV | *_behavior.md |
| TST | *_test.md |

### タスクID形式

```
[プレフィックス][連番]

例: F012
    ├── F: フレームワークタスク
    └── 012: 連番

例: 30102
    └── 30102: ゲーム開発タスク（30000番台）

例: P003
    ├── P: プロジェクト横断タスク
    └── 003: 連番
```

| タイプ | ID形式 | 配置場所 |
|--------|--------|---------|
| framework | FXXX | tasks/ |
| game-dev | 30XXX | project/tasks/ |
| project-wide | PXXX | project/tasks/ |

## 注意事項

- 欠番は埋めない（常に最大値 + 1）
- 連番は001から開始

## ブランチ並行作業時の注意

複数ブランチで同じファイルにIDを追加する場合、ID衝突が発生する可能性があります。

**推奨する運用**:
1. ID追加前に最新の main/develop をマージする
2. 同一ファイルへの並行作業は避ける（機能単位でブランチを分ける）
3. 衝突が発生した場合は、マージ時に手動で連番を振り直す

**衝突時の対処**:
```bash
# マージ後、/id-list でID一覧を確認
/id-list 30101

# 重複があれば、後から追加した方のIDを振り直す
# REQ-30101-005 が重複 → REQ-30101-006 に変更
```

## 終了コード

| コード | 意味 |
|--------|------|
| 0 | 正常終了 |
| 1 | 対象ファイルが見つからなかった |
