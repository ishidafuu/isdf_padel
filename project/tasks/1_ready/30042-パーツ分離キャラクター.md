# 30042: パーツ分離キャラクターシステム

## 概要

ジョイメカファイト風のパーツ分離キャラクターシステムを実装する。頭・胴体・手・膝・足が分離したロボットキャラクターを表現し、将来的に他のゲームでも再利用可能な汎用素体として設計する。

## 背景

- 現在のプレイヤーは単一エンティティ・単一スプライト（40×60px矩形）
- ジョイメカファイトのような分離パーツによる表現力向上が目的
- 汎用素体として切り出し可能な設計にする

## 要件

### パーツ構成（8パーツ）

| パーツ | 数 | 説明 |
|--------|---|------|
| Head | 1 | 頭部 |
| Torso | 1 | 胴体 |
| Hand | 2 | 左右の手 |
| Knee | 2 | 左右の膝 |
| Foot | 2 | 左右の足 |

### 技術選定

- **ECS設計**: Bevy Parent/Children（1階層のみ）+ カスタム同期システム
- **アニメーション**: パラメトリック補間（キーフレーム間の位置・回転を線形/イージング補間）
- **データ外部化**: `.ron`ファイルでアニメーション定義

## 実装計画

### Phase 1: MVP（静的表示）

- [ ] `character/mod.rs` - モジュール定義・CharacterPlugin
- [ ] `character/components.rs` - PartKind, PartDefinition, PartState, ArticulatedCharacter, CharacterFacing
- [ ] `character/bundle.rs` - ArticulatedPlayerBundle, PartBundle
- [ ] `character/systems.rs` - sync_part_transforms_system
- [ ] `main.rs` - CharacterPlugin登録、スポーンコード
- [ ] 仕様書作成 - `project/docs/3_ingame/309_character/`

### Phase 2: アニメーション基盤

- [ ] `character/animation.rs` - AnimationId, CharacterAnimationState, CharacterAnimationData
- [ ] アセットローダー実装
- [ ] `assets/animations/character_animations.ron` - Idleアニメーション定義
- [ ] advance_animation_system, update_part_states_system 実装

### Phase 3: アニメーション遷移

- [ ] Walk, Jump, Fall, Shot アニメーションデータ
- [ ] アニメーション遷移ロジック
- [ ] update_character_facing_system（向き自動判定）
- [ ] イージング補間対応

### Phase 4: 統合・最適化

- [ ] 影システム統合
- [ ] ふっとばしアニメーション対応
- [ ] 既存PlayerBundleからの移行パス検討
- [ ] ホットリロード対応

## 主要ファイル

| ファイル | 操作 | 説明 |
|---------|------|------|
| `project/src/character/mod.rs` | 新規 | CharacterPlugin定義 |
| `project/src/character/components.rs` | 新規 | パーツComponent定義 |
| `project/src/character/animation.rs` | 新規 | アニメーションデータ構造 |
| `project/src/character/bundle.rs` | 新規 | Bundle定義 |
| `project/src/character/systems.rs` | 新規 | System実装 |
| `project/src/main.rs` | 修正 | CharacterPlugin登録 |
| `project/assets/animations/character_animations.ron` | 新規 | アニメーションデータ |

## 検証方法

1. `cargo build` - ビルド成功
2. `cargo run` - ゲーム起動
3. 目視確認 - 8パーツでキャラクター表示
4. アニメーション確認 - Idleアニメーション再生
5. 操作確認 - 移動/ジャンプ/ショットでアニメーション遷移

## 設計上の注意点

- 既存PlayerBundleは残す（互換性維持）
- ハードコーディング禁止（パーツ定義・アニメーションは.ron外部化）
- ECS原則遵守（Component=データ、System=ロジック）
- 1パーツ=1エンティティ

## 関連ドキュメント

- 計画書: `.claude/plans/effervescent-toasting-squirrel.md`
- 参考: ジョイメカファイト（ファミコン、任天堂、1993年）
