---
id: "30021"
title: "サーブ権管理"
type: "game-dev"
status: "done"
priority: "medium"
spec_ids: ["30903"]
blocked_by: ["30013", "30016"]
blocks: []
branch_name: "auto-30021-serve-authority"
worktree_path: null
plan_file: null
tags: ["referee", "mvp", "phase3"]
created_at: "2026-01-06T20:00:00+09:00"
updated_at: "2026-01-07T00:00:00+09:00"
completed_at: "2026-01-07T00:00:00+09:00"
---

# Task 30021: サーブ権管理

## Summary

サーブ権の初期化、交代、サイド判定を実装する。

## Related Specifications

- [30903_serve_authority_spec.md](../../docs/3_ingame/309_referee/30903_serve_authority_spec.md)

## 実装内容

- [x] REQ-30903-001: サーブ権初期化
- [x] REQ-30903-002: ゲーム終了時のサーブ権交代
- [x] REQ-30903-003: デュース/アドサイド判定

## Dependencies

- **Blocked By:** 30013（ポイント進行）, 30016（試合フロー）
- **Blocks:** なし

## 実装概要

### 追加した型・関数

- `ServeSide` enum: デュースサイド/アドバンテージサイド（`src/resource/config.rs`）
- `RallyState.serve_side`: 現在のサーブサイド
- `RallyState.update_serve_side()`: ポイント合計からサーブサイドを判定
- `ServeSide::from_point_total()`: ポイント合計からサーブサイドを計算

### 変更したシステム

- `rally_end_system`: ポイント獲得後にサーブサイドを更新、ゲーム終了時にデュースサイドにリセット

### テスト

- TST-30904-020: サーブ権初期化テスト
- TST-30904-021: サーブ権交代テスト
- TST-30904-022: デュース/アドサイド判定テスト
- TST-30904-023: RallyStateサーブサイド更新テスト

## メモ

- MVP v0.1ではシンプルな交代ルール
- サーバー交代は既に `MatchScore.win_game()` で実装されていた
