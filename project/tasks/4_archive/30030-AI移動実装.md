---
id: "30030"
title: "AI移動実装"
type: "game-dev"
status: "done"
priority: "medium"
related_task: null
spec_ids: ["30301"]
blocked_by: []
blocks: ["30031"]
branch_name: null
worktree_path: null
plan_file: null
tags: ["ai", "movement", "mvp"]
parent_task_id: null
created_at: "2026-01-08T12:00:00"
updated_at: "2026-01-08T15:00:00"
completed_at: "2026-01-08T15:00:00"
---

# Task 30030: AI移動実装

## Summary

AIキャラクターの移動・ポジショニング機能を実装します。

ボールを追跡して打てる位置に移動する基本行動を実現し、対戦相手として機能させます。

## Related Specifications

- [30301_ai_movement_spec.md](../../docs/3_ingame/303_ai/30301_ai_movement_spec.md) - AI移動仕様

## Target Requirements (MVP v0.1)

| REQ-ID | 内容 |
|--------|------|
| REQ-30301-001 | ボール追跡移動 |
| REQ-30301-002 | 移動方向計算 |
| REQ-30301-003 | 到達判定（打球可能距離で停止） |
| REQ-30301-004 | 境界制限 |
| REQ-30301-005 | 待機位置復帰 |

## Implementation Checklist

- [x] AIプレイヤーEntity用のコンポーネント追加（AiController等）
- [x] AiMovementSystemの作成
  - [x] ボール位置取得
  - [x] 移動方向計算（XZ平面）
  - [x] 打球可能距離内で停止
  - [x] コート境界制限
- [x] ホームポジション復帰ロジック
- [x] GameConfig への AI パラメータ追加
  - [x] `ai.move_speed`
  - [x] `ai.home_position`
- [x] `@spec` コメント付与

## Progress

### Completed

- AiController コンポーネント追加 (`src/components/mod.rs`)
- AiConfig 構造体追加 (`src/resource/config.rs`)
- AiMovementSystem 作成 (`src/systems/ai_movement.rs`)
- Player 2 に AiController を付与 (`src/main.rs`)
- テスト追加（移動方向正規化、到達判定）

### 実装詳細

1. **AiController コンポーネント**: ホームポジションを保持
2. **AiConfig**: 移動速度、ホームポジション座標を外部設定化
3. **ai_movement_system**:
   - ボールが自分側にある → ボール追跡
   - ボールが相手側にある → ホームポジション復帰
   - 打球可能距離内で停止
   - コート境界制限

## Dependencies

- **Blocked By:** なし
- **Blocks:** 30031（AIショット実装）

## 完了チェックリスト

> このタスクは in-review 経由必須

- [x] ビルド成功（`cargo build`）
- [x] テスト全PASS（`cargo test`） - 114テストOK
- [x] in-review に移動済み
- [x] レビュー完了

## メモ

- MVP v0.1ではシンプルなボール追跡のみ
- 軌道予測・戦略的ポジショニングはv0.2
