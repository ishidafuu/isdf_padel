---
id: "30018"
title: "ポイント終了処理"
type: "game-dev"
status: "done"
priority: "medium"
spec_ids: ["30103"]
blocked_by: ["30013", "30016"]
blocks: []
branch_name: "auto-30018-point-end"
worktree_path: null
plan_file: null
tags: ["match", "mvp", "phase3"]
created_at: "2026-01-06T20:00:00+09:00"
updated_at: "2026-01-07T00:00:00+09:00"
completed_at: "2026-01-07T14:00:00+09:00"
---

# Task 30018: ポイント終了処理

## Summary

ポイント終了時の処理（失点判定、得点加算、次のポイントへの移行）を実装する。

## Related Specifications

- [30103_point_end_spec.md](../../docs/3_ingame/301_match/30103_point_end_spec.md)

## 実装内容

- [x] REQ-30103-001: ツーバウンド失点（既存のdouble_bounce_judgment_systemで対応）
- [x] REQ-30103-002: ネット失点（net_fault_judgment_system追加）
- [x] REQ-30103-003: 自コート打球失点（own_court_hit_judgment_system追加）
- [x] REQ-30103-004: PointEndEvent（RallyEndEventで発行、OwnCourtHit理由追加）

## 追加した実装

1. **LastShooter コンポーネント** (`components/mod.rs`)
   - 最後にショットを打ったプレイヤーを追跡
   - ネット失点・自コート打球失点の判定に使用

2. **RallyEndReason::OwnCourtHit** (`core/events.rs`)
   - 自コート打球失点の理由を追加

3. **update_last_shooter_system** (`systems/point_judgment.rs`)
   - ShotExecutedEventを受信してLastShooterを更新

4. **net_fault_judgment_system** (`systems/point_judgment.rs`)
   - ラリー中にネットに当たり自コート側に留まった場合の失点判定

5. **own_court_hit_judgment_system** (`systems/point_judgment.rs`)
   - 打った打球が自コートに落ちた場合の失点判定

## Dependencies

- **Blocked By:** 30013（ポイント進行）, 30016（試合フロー）
- **Blocks:** なし

## メモ

- ツーバウンド、ネット失点、自コート打球で失点
- パデルではアウトは存在しない（壁で囲まれている）
