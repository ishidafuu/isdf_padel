---
id: P003-002
title: 入力数値パラメータの外部化
type: project-wide
status: done
parent: P003
priority: high
created: 2026-01-08
blocked_by: [P003-001]
---

# P003-002: 入力数値パラメータの外部化

## 概要

ハードコーディングされている入力関連の数値パラメータを `game_config.ron` で設定可能にする。

## 対象箇所（6箇所）

| パラメータ | 値 | 用途 | ファイル | 実装 |
|-----------|-----|------|---------|------|
| 入力感度 | 1.0 | 移動入力乗算係数 | `human_input.rs` | ✅ input_sensitivity |
| 正規化閾値 | 1.0 | 斜め移動判定 | `movement.rs` | ✅ normalization_threshold |
| ネット位置 | 0.0 | コート分割境界 | `movement.rs` | ✅ CourtConfig.net_z |
| サーブ方向P1 | 1.0 | デフォルト方向 | `serve.rs` | ✅ p1_default_direction_z |
| サーブ方向P2 | -1.0 | デフォルト方向 | `serve.rs` | ✅ p2_default_direction_z |
| ボールオフセット | 0.5 | サーブ時の高さ | `serve.rs` | ✅ ball_spawn_offset_y |

## 作業内容

1. `InputConfig` を拡張（input_sensitivity, normalization_threshold）
2. `ServeConfig` 構造体を新規追加
3. `CourtConfig.net_z` の利用箇所を修正
4. `game_config.ron` に設定を追加

## 設計

### InputConfig 拡張

```rust
pub struct InputConfig {
    pub jump_buffer_time: f32,         // 既存
    pub shot_buffer_time: f32,         // 既存
    pub normalization_threshold: f32,  // 新規: 1.0
    pub input_sensitivity: f32,        // 新規: 1.0（乗算係数、アナログ対応用）
}
```

### ServeConfig 新規

```rust
pub struct ServeConfig {
    pub ball_spawn_offset_y: f32,  // 0.5
    pub p1_default_direction_z: f32, // 1.0
    pub p2_default_direction_z: f32, // -1.0
}
```

## 修正対象ファイル

- `project/src/resource/config.rs`
- `project/assets/config/game_config.ron`
- `project/src/systems/movement.rs`
- `project/src/systems/serve.rs`

## 検証方法

1. `cargo build` - コンパイル確認
2. `cargo test` - 既存テスト通過
3. ゲーム起動・動作確認
4. `game_config.ron` の値変更 → ホットリロード確認
