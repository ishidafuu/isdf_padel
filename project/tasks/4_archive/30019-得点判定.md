---
id: "30019"
title: "得点判定"
type: "game-dev"
status: "done"
priority: "medium"
spec_ids: ["30901"]
blocked_by: ["30009", "30013"]
blocks: []
branch_name: null
worktree_path: null
plan_file: null
tags: ["referee", "mvp", "phase3"]
created_at: "2026-01-06T20:00:00+09:00"
updated_at: "2026-01-07T15:30:00+09:00"
completed_at: "2026-01-07T15:30:00+09:00"
---

# Task 30019: 得点判定

## Summary

得点条件（アウト、ツーバウンド、ネットイン）の判定を実装する。

## Related Specifications

- [30901_point_judgment_spec.md](../../docs/3_ingame/309_referee/30901_point_judgment_spec.md)

## 実装内容

- [x] REQ-30901-001: アウト判定（コート外落下）
- [x] REQ-30901-002: ツーバウンド判定
- [x] REQ-30901-003: ネットイン判定（レット）
- [x] REQ-30901-004: コート境界取得

## Dependencies

- **Blocked By:** 30009（当たり判定）, 30013（ポイント進行）
- **Blocks:** なし

## 実装詳細

### 新規作成ファイル

- `project/src/systems/point_judgment.rs` - ポイント判定システム
  - `bounce_count_update_system` - バウンス回数更新
  - `double_bounce_judgment_system` - ツーバウンド判定
  - `out_of_bounds_judgment_system` - アウト判定（安全弁）
  - `let_judgment_system` - レット判定（サーブ時ネットイン）

### 変更ファイル

- `project/src/resource/scoring.rs` - RallyState, RallyPhase 追加
- `project/src/systems/mod.rs` - point_judgment モジュール追加
- `project/src/main.rs` - PointJudgmentPlugin 登録

### テスト

4件のユニットテストを追加:
- TST-30904-001: ツーバウンド判定
- TST-30904-002: バウンドリセット（コート変更時）
- TST-30904-003: アウト判定
- TST-30904-004: コート境界取得

## メモ

- パデルルール: 壁反射はアウトではない
- 天井もアウトではない
- アウト判定はパデルでは通常発生しない（壁で囲まれているため）が、バグ時の安全弁として実装
