---
id: "30002"
title: "壁反射設計"
type: "game-dev"
status: "done"
priority: "high"
spec_ids: ["30502"]
blocked_by: ["30001"]
blocks: ["30003", "30008"]
branch_name: null
worktree_path: null
plan_file: null
tags: ["court", "mvp", "phase1"]
created_at: "2026-01-06T20:00:00+09:00"
updated_at: "2026-01-06T23:55:00+09:00"
completed_at: "2026-01-06T23:55:00+09:00"
---

# Task 30002: 壁反射設計

## Summary

4面の壁と天井の反射ロジックを実装する。

## Related Specifications

- [30502_wall_design.md](../../docs/3_ingame/305_court/30502_wall_design.md)

## 実装内容

- [x] DES-30502-002: WallType Enum（5種類の壁種別）
- [x] DES-30502-003: WallReflectionEvent
- [x] BEH-30502-001: 左右壁の反射（速度X成分反転）
- [x] BEH-30502-002: 前後壁の反射（速度Z成分反転）
- [x] BEH-30502-003: 天井の反射（速度Y成分反転）
- [x] BEH-30502-004: 壁反射の優先順位
- [x] BEH-30502-005: 反射イベントの発行（WallReflectionEvent構造体）

## 実装ファイル

- `src/core/events.rs` - WallType, WallReflectionEvent
- `src/core/wall.rs` - WallReflection, WallReflectionResult
- `src/core/mod.rs` - モジュール公開

## テスト結果

- 10 tests passed (wall module)
  - test_beh_30502_001_side_wall_reflection
  - test_beh_30502_002_back_wall_reflection
  - test_beh_30502_003_ceiling_reflection
  - test_beh_30502_004_reflection_priority
  - test_reflect_by_wall_type
  - test_no_reflection_when_moving_away
  - test_no_reflection_when_stationary
  - test_no_reflection_inside_court
  - test_wall_type_helpers
  - test_wall_type_normal

## Dependencies

- **Blocked By:** 30001（コート境界定義）✅ Done
- **Blocks:** 30003, 30008

## メモ

- config.Ball.BounceFactor（デフォルト0.8）を参照
- WallTypeを5種類（LeftWall, RightWall, BackWall1P, BackWall2P, Ceiling）に更新
- WallReflection::check_and_reflect で境界チェックと反射を一括処理
