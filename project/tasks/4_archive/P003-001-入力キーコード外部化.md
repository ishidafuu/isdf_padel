---
id: P003-001
title: 入力キーコードの外部化
type: project-wide
status: done
parent: P003
priority: high
created: 2026-01-08
completed: 2026-01-08
---

# P003-001: 入力キーコードの外部化

## 概要

ハードコーディングされている入力キーコード（KeyCode）を `game_config.ron` で設定可能にする。

## 実装結果

### 変更ファイル

| ファイル | 変更内容 |
|---------|---------|
| `Cargo.toml` | bevy の `serialize` feature を追加 |
| `src/resource/config.rs` | `InputKeysConfig` 構造体を追加、`GameConfig` に `input_keys` フィールドを追加 |
| `src/systems/human_input.rs` | キーコード参照を `GameConfig.input_keys` から取得するように変更 |
| `src/systems/boundary.rs` | テストコードに `input_keys` フィールドを追加 |
| `src/systems/fault_judgment.rs` | テストコードに `input_keys` フィールドを追加 |

### InputKeysConfig 構造体

```rust
#[derive(Deserialize, Clone, Debug)]
pub struct InputKeysConfig {
    pub move_up: KeyCode,      // デフォルト: KeyW
    pub move_down: KeyCode,    // デフォルト: KeyS
    pub move_left: KeyCode,    // デフォルト: KeyA
    pub move_right: KeyCode,   // デフォルト: KeyD
    pub move_up_alt: KeyCode,  // デフォルト: ArrowUp
    pub move_down_alt: KeyCode,// デフォルト: ArrowDown
    pub move_left_alt: KeyCode,// デフォルト: ArrowLeft
    pub move_right_alt: KeyCode,// デフォルト: ArrowRight
    pub jump: KeyCode,         // デフォルト: KeyB
    pub shot: KeyCode,         // デフォルト: KeyV
}
```

### 備考

- タスクファイルに記載されていた対象箇所（movement.rs, jump.rs, shot_input.rs, shot_attributes.rs）は実際には入力を一元管理する `human_input.rs` に統合済みだった
- `game_config.ron` へのキー設定追加はオプション（デフォルト値があるため不要）
- 全129テストがパス

## 検証結果

- [x] `cargo build` - コンパイル確認
- [x] `cargo test` - 129テスト通過
