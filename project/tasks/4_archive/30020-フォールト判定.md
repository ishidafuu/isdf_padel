---
id: "30020"
title: "フォールト判定"
type: "game-dev"
status: "done"
priority: "medium"
spec_ids: ["30902"]
blocked_by: ["30017"]
blocks: []
branch_name: null
worktree_path: null
plan_file: null
tags: ["referee", "mvp", "phase3"]
created_at: "2026-01-06T20:00:00+09:00"
updated_at: "2026-01-07T00:00:00+09:00"
completed_at: "2026-01-07T00:00:00+09:00"
---

# Task 30020: フォールト判定

## Summary

サーブ時のフォールト判定を実装する。

## Related Specifications

- [30902_fault_spec.md](../../docs/3_ingame/309_referee/30902_fault_spec.md)

## 実装内容

- [x] REQ-30902-001: サーブエリア判定
- [x] REQ-30902-002: ダブルフォルト判定
- [x] REQ-30902-003: Faultカウンタ管理

## Dependencies

- **Blocked By:** 30017（サーブ処理）
- **Blocks:** なし

## 実装概要

### 追加したファイル
- `src/systems/fault_judgment.rs` - フォールト判定システム

### 変更したファイル
- `src/resource/config.rs` - CourtConfigに`service_box_depth`を追加
- `src/core/events.rs` - FaultEvent, DoubleFaultEvent, FaultReason, RallyEndReason::DoubleFaultを追加
- `src/systems/match_flow.rs` - サーブ→ラリー遷移をフォールト判定対応に更新
- `src/systems/mod.rs` - fault_judgmentモジュールを追加
- `src/main.rs` - FaultJudgmentPluginを追加

### 機能
1. サービスボックス判定（デュース側/アド側）
2. フォールト発生時のカウント管理（1stフォルト→セカンドサーブ）
3. ダブルフォルト時のポイント処理（レシーバーに得点）

## メモ

- MVP v0.1では簡易フォールト判定
- フットフォルト、レット時のFault継続はv0.2で実装予定
