---
id: "30036"
title: "壁ヒット時アウト判定追加"
type: "game-dev"
status: "done"
priority: "high"
related_task: null
spec_ids: ["30501", "30901"]
blocked_by: ["30035"]
blocks: ["30037"]
branch_name: null
worktree_path: null
plan_file: "~/.claude/plans/structured-purring-narwhal.md"
tags: ["tennis", "wall", "out", "judgment"]
parent_task_id: null
created_at: "2026-01-08T16:00:00"
updated_at: "2026-01-08T18:00:00"
completed_at: "2026-01-08T18:00:00"
---

# Task 30036: 壁ヒット時アウト判定追加

## Summary

テニスルールに合わせ、ボールが壁（フェンス）に当たった時点でラリー終了（アウト）とする。
パデルでは壁反射後もプレー継続だったが、テニスでは壁ヒット=インプレー終了。

## Related Specifications

- `project/docs/3_ingame/305_court/30501_court_spec.md` - コート仕様
- `project/docs/3_ingame/309_referee/30901_point_judgment_spec.md` - ポイント判定

## Progress

### Completed

- タスク方針変更（削除→アウト判定追加）
- `point_judgment.rs` に `wall_hit_judgment_system` 追加
- `WallReflectionEvent` 受信でラリー終了（Out）を発行
- テスト追加（TST-30036-001, TST-30036-002）
- ビルド成功・テスト全PASS（131件）
- **レビュー後修正**: `@spec` コメント追加
- **レビュー後修正**: 仕様書に REQ-30901-006 追記

## Dependencies

- **Blocked By:** 30035（仕様書更新が先）
- **Blocks:** 30037（アウト判定追加と統合）

## Implementation Summary

### 追加した処理

1. `wall_hit_judgment_system` - 壁ヒット時のアウト判定
   - `WallReflectionEvent` を監視
   - 壁に当たったら `RallyEndEvent`（reason: Out）を発行
   - `LastShooter` の相手側が得点

### 修正対象ファイル

| ファイル | 変更内容 |
|---------|---------|
| `project/src/systems/point_judgment.rs` | `wall_hit_judgment_system` 追加、プラグイン登録、`@spec` コメント追加 |
| `project/docs/3_ingame/309_referee/30901_point_judgment_spec.md` | REQ-30901-006 追記 |

## 完了チェックリスト

> このタスクは in-review 経由必須

- [x] ビルド成功（`cargo build`）
- [x] テスト全PASS（`cargo test`）
- [x] in-review に移動済み
- [x] レビュー完了

## レビュー結果

### 指摘事項と対応

| 指摘 | 対応 |
|------|------|
| `@spec` コメントの欠如 | ✅ `@spec 30901_point_judgment_spec.md#REQ-30901-006` 追加 |
| 仕様書への要件追記 | ✅ REQ-30901-006（壁ヒット判定）追記 |

### 最終確認

- ビルド: ✅ 成功
- テスト: ✅ 131件 PASS

## メモ

- 壁反射ロジック自体は残す（物理的にはボールは跳ね返る）
- 壁ヒット時点で即座にラリー終了
- 元タスク「壁システム削除」から方針変更
