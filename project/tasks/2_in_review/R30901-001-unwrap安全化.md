---
id: "R30901-001"
title: "point_judgment.rsのunwrap安全化"
type: "refactor"
status: "in_review"
priority: "high"
related_task: "30019"
spec_ids: ["30901"]
blocked_by: []
blocks: []
branch_name: "task/R30901-001-unwrap-safety"
worktree_path: "../isdf_padel-R30901-001"
plan_file: null
tags: ["systems", "safety", "unwrap", "audit"]
parent_task_id: null
created_at: "2026-01-08T00:00:00"
updated_at: "2026-01-08T00:00:00"
completed_at: null
---

# Task R30901-001: point_judgment.rsのunwrap安全化

## Summary

audit-agent による監査で検出された問題。
`point_judgment.rs` 内で `unwrap()` が5箇所使用されており、ゲームプレイ中のクラッシュリスクがある。

## 検出箇所

| 行 | コード | リスク |
|----|--------|--------|
| 475 | `last_court_side.unwrap().opponent()` | None時クラッシュ |
| 498 | `last_shooter.side.unwrap().opponent()` | None時クラッシュ |
| 530 | `last_shooter.side.unwrap().opponent()` | None時クラッシュ |
| 563 | `last_shooter.side.unwrap().opponent()` | None時クラッシュ |
| 587 | `last_shooter.side.unwrap().opponent()` | None時クラッシュ |

## Related Specifications

- [30901_point_judgment_spec.md](../../docs/3_ingame/309_referee/30901_point_judgment_spec.md)

## Next Actions

1. 各 `unwrap()` を `if let Some()` または `match` に置換
2. None の場合の適切なフォールバック処理を実装
3. エッジケースのテスト追加

## 推奨パターン

```rust
// Before
let winner = last_court_side.unwrap().opponent();

// After（例1: 早期リターン）
let Some(court_side) = last_court_side else {
    warn!("last_court_side is None, skipping judgment");
    return;
};
let winner = court_side.opponent();

// After（例2: デフォルト値）
let winner = last_court_side
    .map(|side| side.opponent())
    .unwrap_or(CourtSide::Near);
```

## 完了チェックリスト

> このタスクは in-review 経由必須

- [x] ビルド成功（`cargo build`）
- [x] テスト全PASS（`cargo test`）
- [x] in-review に移動済み
- [ ] レビュー完了

## メモ

- ゲームの状態遷移でNoneになるタイミングを調査が必要
- 特にゲーム開始直後やポイント終了直後の状態を確認
