# 30049: 弾道デバッグマーカー機能

## 概要

不自然な打球（届かない/アウト/上に行きすぎ）を発見した時に、3ボタン目（X）でマークして弾道計算の詳細ログを出力する機能。

## 背景

- ショットが思った通りに飛ばない問題が発生
- 毎ショットログを出すと大量になりすぎる
- プレイ中に「おかしい」と気づいた時だけ詳細を確認したい

## 仕様

1. ショット実行時に弾道計算の詳細を一時保存
2. ボールが空中にある間（バウンド前）に3ボタン目（X）を押す
3. 押した時点で `[MARKED]` 付きログを出力
4. バウンド後はマーク無効（一時保存をクリア）

## 実装内容

### 修正対象ファイル

1. `project/src/resource/mod.rs` - `LastShotDebugInfo` リソース追加
2. `project/src/systems/shot_direction.rs` - 弾道詳細を一時保存
3. `project/src/systems/debug_marker.rs`（新規）- Xボタンでマーク出力
4. `project/src/systems/ball_trajectory.rs` - バウンド時にクリア

### LastShotDebugInfo リソース

```rust
#[derive(Resource, Default)]
pub struct LastShotDebugInfo {
    pub is_valid: bool,
    pub player_id: u32,
    pub ball_pos: Vec3,
    pub input: Vec2,
    pub court_side: Option<CourtSide>,
    pub power: f32,
    pub spin: f32,
    pub accuracy: f32,
    pub landing: Vec3,
    pub launch_angle: f32,
    pub final_speed: f32,
    pub velocity: Vec3,
    pub discriminant: f32,
    pub g_eff: f32,
}
```

### ログ出力例

```
[MARKED] ========================================
[MARKED] player=1, court_side=Some(Left)
[MARKED] ball_pos=(-4.00,1.00,0.00), input=(0.50,0.00)
[MARKED] power=15.0, spin=0.10, accuracy=1.00
[MARKED] landing=(4.00,2.75), angle=38.4°, speed=6.0
[MARKED] velocity=(4.43,3.73,3.16)
[MARKED] discriminant=48765.2, g_eff=4.12
[MARKED] ========================================
```

## 検証方法

1. `cargo run` でゲーム起動
2. ショット後、ボールが飛んでいる間にXボタンを押す
3. ターミナルに `[MARKED]` ログが出力される
4. `grep "\[MARKED\]"` で抽出可能

## 問題特定の目安

| 症状 | 確認する値 | 異常の目安 |
|------|-----------|-----------|
| 上に行きすぎ | launch_angle | > 50° |
| 届かない | discriminant | < 0 |
| アウト | landing.x, landing.z | > ±8, > ±6 |
| 弱すぎ | power, final_speed | < 5 |

## 関連

- プラン: `/Users/ishidafuu/.claude/plans/jazzy-wandering-giraffe.md`
