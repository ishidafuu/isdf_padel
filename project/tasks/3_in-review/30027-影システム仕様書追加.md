---
id: "30027"
title: "影システム仕様書追加"
type: "game-dev"
status: "in-review"
priority: "low"
related_task: null
spec_ids: ["REQ-30801-001", "REQ-30801-002", "REQ-30801-003", "REQ-30801-004", "REQ-30801-005"]
blocked_by: []
blocks: []
branch_name: null
worktree_path: null
plan_file: null
tags: ["presentation", "shadow", "spec"]
parent_task_id: null
audit_source: "2026-01-07"
created_at: "2026-01-07T20:45:48+09:00"
updated_at: "2026-01-07T21:10:00+09:00"
completed_at: null
---

# Task 30027: 影システム仕様書追加

## Summary

コード監査で検出された問題：presentation層の影関連システムに@specコメントがなく、対応する仕様書も存在しない。
仕様書駆動開発の原則に従い、既存実装に対応する仕様書を追加する。

## 検出された問題

監査日時: 2026-01-07

以下のpublic関数に@specコメントがない：

| ファイル | 関数 | 備考 |
|---------|------|------|
| `presentation/mod.rs:20` | `sync_transform_system()` | 論理座標→表示座標変換 |
| `presentation/mod.rs:36` | `sync_shadow_system()` | 影位置同期 |
| `presentation/mod.rs:62` | `spawn_ball_shadow_system()` | ボール影生成 |
| `presentation/mod.rs:91` | `spawn_player_shadow_system()` | プレイヤー影生成 |
| `presentation/mod.rs:115` | `despawn_ball_shadow_system()` | ボール影削除 |

## 作業内容

1. 仕様書を作成
   - `project/docs/3_ingame/308_presentation/30801_shadow_spec.md`（または適切な番号）
   - EARS記法で要件を記述

2. 既存実装に@specコメントを追加
   - 各public関数にREQ-IDを対応付け

## Related Specifications

- 新規作成: 308_presentation/30801_shadow_spec.md
- 参照: 20001_layers.md#layer-5-presentation

## Progress

### Completed

- [x] 308_presentation ディレクトリ作成
- [x] 30801_shadow_spec.md を EARS記法で作成
  - REQ-30801-001: プレイヤー影の生成
  - REQ-30801-002: ボール影の生成
  - REQ-30801-003: 影位置の同期
  - REQ-30801-004: ボール影の削除
  - REQ-30801-005: 座標変換（論理→表示）
- [x] 既存実装に @spec コメントを追加
  - `spawn_player_shadow_system` → REQ-30801-001
  - `spawn_ball_shadow_system` → REQ-30801-002
  - `sync_shadow_system` → REQ-30801-003
  - `despawn_ball_shadow_system` → REQ-30801-004
  - `sync_transform_system` → REQ-30801-005

## Next Actions

1. レビュー完了後に archive へ移動

## Dependencies

- **Blocked By:** なし
- **Blocks:** なし

## 完了チェックリスト

> このタスクは in-review 経由必須

- [x] ビルド成功（`cargo build`）
- [x] テスト全PASS（`cargo test`） - 105件
- [x] in-review に移動済み
- [ ] レビュー完了

## メモ

- 深刻度: MINOR（共通ユーティリティとして許容可能だが、仕様書があるとより良い）
- 優先度: low（即時対応の必要なし）
- core/utils.rs のユーティリティ関数（reflect, distance_2d等）は数学的な共通関数として@spec不要と判断
