---
id: "30034"
title: "スピン軌道影響実装"
type: "game-dev"
status: "todo"
priority: "medium"
related_task: null
spec_ids: ["30401", "30402"]
blocked_by: []
blocks: []
branch_name: null
worktree_path: null
plan_file: null
tags: ["v0.3", "spin", "trajectory"]
parent_task_id: null
created_at: "2026-01-08T13:28:00"
updated_at: "2026-01-08T13:28:00"
completed_at: null
---

# Task 30034: スピン軌道影響実装

## Summary

v0.2で計算されたスピン値を実際のボール軌道・バウンド挙動に反映させる。
トップスピン/スライスによる球種の違いを表現する。

## Related Specifications

- `project/docs/3_ingame/304_ball/30401_trajectory_spec.md` - 軌道仕様（v0.3要件）
- `project/docs/3_ingame/304_ball/30402_reflection_spec.md` - 反射仕様（v0.3要件）
- `project/docs/8_data/80101_game_constants.md#spin-physics-config` - SpinPhysicsConfig
- `project/docs/3_ingame/30011_v03_scope.md` - v0.3スコープ定義

## Implementation Plan

### 実装する機能

| 機能 | REQ-ID | 説明 |
|------|--------|------|
| 重力変動 | REQ-30401-100 | スピンに応じて実効重力を変動 |
| スピン時間減衰 | REQ-30401-101 | 飛行中にスピン効果が減衰 |
| 空気抵抗 | REQ-30401-102 | スピン絶対値に応じた減速 |
| バウンド挙動変化 | REQ-30402-100 | スピンに応じた水平/垂直バウンド係数 |

### Step 1: パラメータ追加

- [ ] `config.rs`: SpinPhysicsConfig構造体追加
- [ ] `game_config.ron`: spin_physicsセクション追加
- [ ] `GameConfig`: spin_physicsフィールド追加

### Step 2: システム修正

- [ ] `ball_gravity_system`: BallSpin参照追加、重力変動計算
- [ ] `ball_ground_bounce_system`: スピン考慮のバウンド計算

### Step 3: システム追加

- [ ] `ball_air_drag_system`: 空気抵抗（新規）
- [ ] `ball_spin_decay_system`: スピン減衰（新規）

### Step 4: システム登録

- [ ] BallTrajectoryPlugin のシステム登録順序更新

### Step 5: テスト

- [ ] 単体テスト追加（TST-30404-100〜106）
- [ ] ビルド・テスト通過確認
- [ ] 視覚確認（ゲーム起動）

## Modified Files

| ファイル | 変更内容 |
|---------|---------|
| `project/src/resource/config.rs` | SpinPhysicsConfig追加 |
| `project/assets/config/game_config.ron` | パラメータ追加 |
| `project/src/systems/ball_trajectory.rs` | 4システム修正/追加 |
| `project/src/systems/mod.rs` | 必要に応じてエクスポート追加 |

## Acceptance Criteria

- [ ] SpinPhysicsConfigが実装され、RONで設定可能
- [ ] トップスピンでボールが早く落ちる
- [ ] スライスでボールが浮く
- [ ] バウンド時にスピンに応じた挙動変化がある
- [ ] スピン効果が時間経過で減衰する
- [ ] 空気抵抗がスピンに応じて適用される
- [ ] 全テストが通過する

## Dependencies

- **Blocked By:** なし（v0.2完了済み）
- **Blocks:** なし

## Notes

- v0.2で実装済みのスピン計算（shot_attributes.rs）は変更不要
- v0.2で実装済みのスピン視覚化（ボール色）はそのまま使用
- 壁反射時のスピン挙動変化はv0.3では含まない（地面バウンドのみ）
