---
id: "P003-004"
title: "スコアリングシステムECS化"
type: "project-wide"
status: "todo"
priority: "high"
related_task: "P003"
spec_ids: []
blocked_by: []
blocks: ["P003-006"]
branch_name: null
worktree_path: null
plan_file: null
tags: ["refactor", "ECS", "scoring"]
parent_task_id: "P003"
created_at: "2026-01-08T13:49:00"
updated_at: "2026-01-08T13:49:00"
completed_at: null
---

# Task P003-004: スコアリングシステムECS化

## Summary

MatchScore リソース内の `player1_score/player2_score` 固定識別子を CourtSide ベースに変更し、ECS設計原則に準拠させる。

## Background

P003（プレイヤー入力システムリファクタリング）で入力系は修正完了。
しかしスコアリング系に固定識別子が残存しており、CLAUDE.md ルール4「ECS設計原則」に違反。

## Current Problem

```rust
// resource/scoring.rs - ECS原則違反
pub struct MatchScore {
    pub player1_point: PlayerPoint,      // ❌ 固定識別子
    pub player2_point: PlayerPoint,      // ❌ 固定識別子
    pub player1_score: PlayerGameScore,  // ❌ 固定識別子
    pub player2_score: PlayerGameScore,  // ❌ 固定識別子
}
```

## Implementation Plan

### Option A: 配列ベース（推奨）

```rust
pub struct MatchScore {
    pub points: [PlayerPoint; 2],        // [0] = Player1側, [1] = Player2側
    pub scores: [PlayerGameScore; 2],
    pub server: CourtSide,
    // ...
}

impl MatchScore {
    pub fn get_point(&self, side: CourtSide) -> &PlayerPoint {
        &self.points[side as usize]
    }
    pub fn get_score(&self, side: CourtSide) -> &PlayerGameScore {
        &self.scores[side as usize]
    }
}
```

### Option B: HashMap ベース

```rust
pub scores: HashMap<CourtSide, PlayerGameScore>,
```

## Modified Files

| ファイル | 変更内容 |
|---------|---------|
| `project/src/resource/scoring.rs` | MatchScore 構造体 |
| `project/src/systems/scoring.rs` | スコア更新システム |
| `project/src/presentation/debug_ui.rs` | スコア表示 |

## Acceptance Criteria

- [ ] MatchScore から `player1_*`, `player2_*` フィールド削除
- [ ] CourtSide ベースのアクセサメソッド実装
- [ ] 全参照箇所の更新
- [ ] テスト通過

## Dependencies

- **Blocked By:** なし
- **Blocks:** P003-006（playerID参照箇所整理）

## Notes

- 並列実行可（P003-001〜003と並列可能）
