---
id: P003-001
title: 入力キーコードの外部化
type: project-wide
status: todo
parent: P003
priority: high
created: 2026-01-08
---

# P003-001: 入力キーコードの外部化

## 概要

ハードコーディングされている入力キーコード（KeyCode）を `game_config.ron` で設定可能にする。

## 対象箇所（10箇所）

| キー | 用途 | ファイル | 行 |
|------|------|---------|-----|
| W | 上移動 | `movement.rs` | 33 |
| S | 下移動 | `movement.rs` | 36 |
| A | 左移動 | `movement.rs` | 41 |
| D | 右移動 | `movement.rs` | 44 |
| ↑ | 上移動（代替） | `movement.rs` | 33 |
| ↓ | 下移動（代替） | `movement.rs` | 36 |
| ← | 左移動（代替） | `movement.rs` | 41 |
| → | 右移動（代替） | `movement.rs` | 44 |
| B | ジャンプ | `jump.rs` | 27 |
| V | ショット | `shot_input.rs:25`, `shot_attributes.rs:97` |

## 作業内容

1. `Cargo.toml` に bevy の `serialize` feature を追加
2. `config.rs` に `InputKeysConfig` 構造体を追加
3. `GameConfig` に `input_keys` フィールドを追加
4. `game_config.ron` にキー設定を追加（オプション）
5. 各システムファイルでハードコードを設定参照に変更:
   - `movement.rs`
   - `jump.rs`
   - `shot_input.rs`
   - `shot_attributes.rs`

## InputKeysConfig 設計

```rust
#[derive(Serialize, Deserialize, Clone, Debug)]
pub struct InputKeysConfig {
    pub move_up: KeyCode,
    pub move_down: KeyCode,
    pub move_left: KeyCode,
    pub move_right: KeyCode,
    pub move_up_alt: KeyCode,
    pub move_down_alt: KeyCode,
    pub move_left_alt: KeyCode,
    pub move_right_alt: KeyCode,
    pub jump: KeyCode,
    pub shot: KeyCode,
}
```

## キー配置（現状維持）

- Player 1/2 共通: W/S/A/D（移動）、B（ジャンプ）、V（ショット）
- 代替キー: 矢印キー（移動のみ）

## 検証方法

1. `cargo build` - コンパイル確認
2. `cargo test` - 既存テスト通過
3. ゲーム起動・動作確認
4. `game_config.ron` のキー変更 → ホットリロード確認
