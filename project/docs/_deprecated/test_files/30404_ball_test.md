# Ball Test Cases

**Version**: 1.0.0
**Status**: Draft
**Last Updated**: 2025-12-23

## 概要

ボール物理（軌道、反射、衝突）の統合テストシナリオを定義します。

## テストケース

### 軌道テスト（30401_trajectory_spec.md）

#### TST-30404-001: 放物線運動
**対応**: REQ-30401-001
**Given**: ボール初期位置: (0, 1, 0)、ボール初期速度: (0, 5, 0) m/s、重力: -9.8 m/s²
**When**: 1秒経過後
**Then**:
- ボール位置: (0, 1 + 5*1 - 0.5*9.8*1², 0) = (0, 1.1, 0)
- 速度: (0, 5 - 9.8*1, 0) = (0, -4.8, 0)

---

#### TST-30404-002: 初期速度設定
**対応**: REQ-30401-002
**Given**: プレイヤー位置: (0, 0, 0)
**When**: 通常ショットを発射
**Then**: ボール初速度 = 10.0 m/s

---

#### TST-30404-003: 位置更新
**対応**: REQ-30401-003
**Given**: ボール位置: (0, 1, 0)、ボール速度: (2, 0, 0) m/s、deltaTime = 0.1秒
**When**: 物理演算フレーム実行
**Then**: 新しい位置: (0.2, 1, 0)

---

#### TST-30404-004: 速度更新（重力適用）
**対応**: REQ-30401-004
**Given**: ボール速度: (0, 5, 0) m/s、重力: -9.8 m/s²、deltaTime = 0.1秒
**When**: 物理演算フレーム実行
**Then**: 新しい速度: (0, 5 - 9.8*0.1, 0) = (0, 4.02, 0)

---

#### TST-30404-005: コート範囲チェック
**対応**: REQ-30401-005
**Given**: ボール位置: (3, 1, 2)、コート範囲: X: ±5.0, Z: ±3.0
**When**: 範囲チェック
**Then**: コート内と判定される

---

#### TST-30404-006: アウトオブバウンズ検出
**対応**: REQ-30401-006
**Given**: ボール位置: (0, -0.1, 0)（地面下）
**When**: 範囲チェック
**Then**: `BallOutOfBoundsEvent` が発行される

---

### 反射テスト（30402_reflection_spec.md）

#### TST-30404-007: 地面バウンド
**対応**: REQ-30402-001
**Given**: ボール位置: (0, 0, 0)、ボール速度: (0, -5, 0) m/s、バウンド係数: 0.8
**When**: 地面に接触
**Then**: 新しい速度: (0, 5 * 0.8, 0) = (0, 4, 0)

---

#### TST-30404-008: バウンドイベント発行
**対応**: REQ-30402-002
**Given**: ボールが地面にバウンド
**When**: バウンド処理実行
**Then**: `BallBounceEvent` が発行される

---

#### TST-30404-009: 壁反射（X軸）
**対応**: REQ-30402-003
**Given**: ボール位置: (5.0, 1, 0)（右壁）、ボール速度: (3, 0, 0) m/s
**When**: 壁に到達
**Then**: 新しい速度: (-3 * 0.8, 0, 0) = (-2.4, 0, 0)

---

#### TST-30404-010: 壁反射イベント発行
**対応**: REQ-30402-004
**Given**: ボールが壁に反射
**When**: 反射処理実行
**Then**: `WallReflectionEvent` が発行される

---

#### TST-30404-011: 奥壁反射（Z軸）
**対応**: REQ-30402-005
**Given**: ボール位置: (0, 1, 3.0)（奥壁）、ボール速度: (0, 0, 5) m/s
**When**: 奥壁に到達
**Then**: 新しい速度: (0, 0, -5 * 0.8) = (0, 0, -4.0)

---

#### TST-30404-012: 天井反射
**対応**: REQ-30402-006
**Given**: ボール位置: (0, 5.0, 0)（天井）、ボール速度: (0, 3, 0) m/s
**When**: 天井に到達
**Then**: 新しい速度: (0, -3 * 0.8, 0) = (0, -2.4, 0)

---

#### TST-30404-013: 壁反射時のめり込み防止
**対応**: REQ-30402-007
**Given**: ボール位置: (5.1, 1, 0)（壁を超えている）、壁境界: X = ±5.0
**When**: 壁反射処理
**Then**: 位置が補正される: Position.X = 5.0

---

### 衝突テスト（30403_collision_spec.md）

#### TST-30404-014: プレイヤーとの当たり判定
**対応**: REQ-30403-001
**Given**: ボール位置: (1, 0, 0)、プレイヤー位置: (1.5, 0, 0)、判定半径: 0.7 m、プレイヤー無敵状態: false
**When**: 衝突判定
**Then**: 距離 0.5 < 0.7 → 衝突と判定

---

#### TST-30404-015: ふっとばしトリガー
**対応**: REQ-30403-002
**Given**: ボールがプレイヤーに衝突
**When**: 衝突検出
**Then**: `BallHitEvent` が発行される

---

#### TST-30404-016: 無敵時間中の衝突無視
**対応**: REQ-30403-003
**Given**: プレイヤー無敵状態: true
**When**: ボールが接触
**Then**: 衝突が無視される（BallHitEvent 発行されず）

---

#### TST-30404-017: ボール反射（プレイヤー衝突時）
**対応**: REQ-30403-004
**Given**: ボールがプレイヤーに衝突
**When**: 衝突処理
**Then**: ボール速度が反転する

---

#### TST-30404-018: 衝突判定頻度
**対応**: REQ-30403-005
**Given**: 物理演算フレーム実行中
**When**: `_PhysicsProcess` 実行
**Then**: 全プレイヤーとの距離が計算される

---

#### TST-30404-019: 複数プレイヤー衝突時の優先順位
**対応**: REQ-30403-006
**Given**: ボール位置: (0, 0, 0)、プレイヤー1位置: (0.3, 0, 0)、プレイヤー2位置: (0.6, 0, 0)
**When**: 衝突判定
**Then**: プレイヤー1との衝突が優先される

---

## エッジケース

### EC-30404-001: 壁と地面の同時衝突
**Given**: ボール位置: (5.0, 0, 0)（壁かつ地面）、ボール速度: (3, -2, 0) m/s
**When**: 衝突処理
**Then**: 地面バウンド → 壁反射の順に処理

---

### EC-30404-002: 天井と壁の同時衝突
**Given**: ボール位置: (5.0, 5.0, 0)（壁かつ天井）、ボール速度: (3, 2, 0) m/s
**When**: 衝突処理
**Then**: X軸・Y軸それぞれ反射処理

---

## データ参照

全テストケースは以下のデータを参照します：
- [80101_game_constants.md](../../8_data/80101_game_constants.md) - Ball, Court, Collision, Physics パラメータ

---

## 依存関係

### 依存先
- [30401_trajectory_spec.md](30401_trajectory_spec.md) - 軌道仕様
- [30402_reflection_spec.md](30402_reflection_spec.md) - 反射仕様
- [30403_collision_spec.md](30403_collision_spec.md) - 衝突仕様
