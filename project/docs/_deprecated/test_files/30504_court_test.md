# Court Test Cases

**Version**: 1.0.0
**Status**: Draft
**Last Updated**: 2025-12-23

## 概要

コート構造、壁反射、境界判定のテストシナリオを定義します。

## テストケース

### TST-30504-001: コート座標系の確認
**対応**: REQ-30501-001
**Given**: コートが初期化されている
**When**: 座標系を確認する
**Then**:
- X軸: 左右方向
- Y軸: 高さ方向
- Z軸: 前後方向

---

### TST-30504-002: コート左右境界の確認
**対応**: REQ-30501-002
**Given**: コートが初期化されている
**When**: 左端座標と右端座標を取得する
**Then**:
- 左端 X = -5.0m
- 右端 X = +5.0m

---

### TST-30504-003: コート前後境界の確認
**対応**: REQ-30501-003
**Given**: コートが初期化されている
**When**: 前端座標と後端座標を取得する
**Then**:
- 後端（1P側）Z = -3.0m
- 後端（2P側）Z = +3.0m

---

### TST-30504-004: コート天井高さの確認
**対応**: REQ-30501-004
**Given**: コートが初期化されている
**When**: 天井高さを取得する
**Then**: 天井 Y = 5.0m

---

### TST-30504-005: ネット位置の確認
**対応**: REQ-30501-005
**Given**: コートが初期化されている
**When**: ネット位置を取得する
**Then**:
- ネット X = 0
- ネット Z = 0
- ネット高さ Y = 0.88m

---

### TST-30504-006: コート区分の確認
**対応**: REQ-30501-006
**Given**: コートが初期化されている
**When**: 座標 (0, 0, -1) のコート区分を判定する
**Then**: 1Pコートと判定される
**And When**: 座標 (0, 0, +1) のコート区分を判定する
**And Then**: 2Pコートと判定される

---

### TST-30504-007: 左右壁の反射
**対応**: BEH-30502-001
**Given**: ボールが左壁に向かって移動している（速度 X=-5, Y=0, Z=0）
**When**: ボールが左壁に接触する
**Then**:
- 速度が反転: X=+5 * 0.8 = +4
- WallReflectionEvent が発行される
- WallType = LeftWall

---

### TST-30504-008: 前後壁の反射
**対応**: BEH-30502-002
**Given**: ボールが後壁（1P側）に向かって移動している（速度 X=0, Y=0, Z=-5）
**When**: ボールが後壁に接触する
**Then**:
- 速度が反転: Z=+5 * 0.8 = +4
- WallReflectionEvent が発行される
- WallType = BackWall1P

---

### TST-30504-009: 天井の反射
**対応**: BEH-30502-003
**Given**: ボールが天井に向かって移動している（速度 X=0, Y=+8, Z=0）
**When**: ボールが天井に接触する
**Then**:
- 速度が反転: Y=-8 * 0.8 = -6.4
- WallReflectionEvent が発行される
- WallType = Ceiling

---

### TST-30504-010: 壁反射イベントの発行
**対応**: BEH-30502-005
**Given**: ボールが壁に接触する
**When**: 反射処理が実行される
**Then**:
- WallReflectionEvent がイベントバスに発行される
- イベントに Ball, WallType, ContactPoint, IncidentVelocity, ReflectedVelocity が含まれる

---

### TST-30504-011: プレイヤーの左右壁制限
**対応**: BEH-30503-001
**Given**: プレイヤーが左壁に向かって移動している
**When**: プレイヤーが左壁に接触する
**Then**:
- Position.X が左壁座標に制限される
- Velocity.X = 0

---

### TST-30504-012: プレイヤーの前後壁制限
**対応**: BEH-30503-002
**Given**: プレイヤーが後壁に向かって移動している
**When**: プレイヤーが後壁に接触する
**Then**:
- Position.Z が後壁座標に制限される
- Velocity.Z = 0

---

### TST-30504-013: プレイヤーのネット通過禁止
**対応**: BEH-30503-003
**Given**: 1Pプレイヤーがネットに向かって移動している
**When**: プレイヤーがネット位置（Z=0）に接触する
**Then**:
- Position.Z が 0 未満に制限される
- Velocity.Z = 0

---

### TST-30504-014: ボールの壁反射判定
**対応**: BEH-30503-004
**Given**: ボールが各壁境界に接触する
**When**: 境界判定を実行する
**Then**:
- 左壁: Position.X ≤ -5.0 で判定
- 右壁: Position.X ≥ +5.0 で判定
- 後壁（1P側）: Position.Z ≤ -3.0 で判定
- 後壁（2P側）: Position.Z ≥ +3.0 で判定
- 天井: Position.Y ≥ 5.0 で判定

---

### TST-30504-015: ボールのネット接触判定
**対応**: BEH-30503-005
**Given**: ボールがネット位置に移動する
**When**: ネット接触判定を実行する
**Then**:
- Position.Y < 0.88m かつ |Position.Z| < 0.1m でネット接触と判定
- NetHitEvent が発行される

---

### TST-30504-016: ボールのコート区分判定
**対応**: BEH-30503-006
**Given**: ボールが各コートに存在する
**When**: コート区分判定を実行する
**Then**:
- Position.Z < 0 の場合、1Pコートと判定
- Position.Z > 0 の場合、2Pコートと判定

---

### TST-30504-017: 境界チェックの優先順位
**対応**: BEH-30503-007
**Given**: ボールがネットと壁に同時に接触する可能性がある
**When**: 境界判定を実行する
**Then**:
- ネット接触が最優先で判定される
- ネット接触の場合、壁反射は実行されない

---

## エッジケース

### EC-30504-001: コーナーへの同時接触
**Given**: ボールがコートのコーナー（例: 左壁と後壁の交点）に向かう
**When**: 境界判定を実行する
**Then**:
- 最も近い壁との接触を優先
- 2回目のフレームで次の壁との反射を処理

---

### EC-30504-002: 高速移動時の壁すり抜け
**Given**: ボールが1フレームで壁を超える速度で移動している
**When**: 境界判定を実行する
**Then**:
- 線分交差判定により、壁を超える前に反射を検出（将来実装）
- 現バージョンでは、Position を壁の内側に補正

---

### EC-30504-003: ネット上ギリギリの通過
**Given**: ボールがネット高さギリギリ（Position.Y ≈ 0.88m）で移動している
**When**: ネット接触判定を実行する
**Then**:
- Position.Y < 0.88m の場合のみネット接触と判定
- Position.Y ≥ 0.88m の場合はプレイ続行

---

## パフォーマンステスト

### PT-30504-001: 境界判定のパフォーマンス
**目的**: 毎フレーム実行される境界判定が60FPSを維持できるか確認
**条件**: プレイヤー2人、ボール1個の標準状態
**期待**: 境界判定の処理時間が1フレーム（16.67ms）の10%以下

---

## データ参照

全テストケースは以下のデータを参照します：
- [80101_game_constants.md](../../8_data/80101_game_constants.md) - Court, Ball パラメータ

---

## 依存関係

### 依存先
- [30501_court_spec.md](30501_court_spec.md) - コート仕様
- [30502_wall_design.md](30502_wall_design.md) - 壁反射設計
- [30503_boundary_behavior.md](30503_boundary_behavior.md) - 境界判定動作
