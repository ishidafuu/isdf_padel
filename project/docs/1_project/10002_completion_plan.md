# 10002 完成ロードマップ（実行計画）

**Version**: 1.0.0  
**Last Updated**: 2026-02-08  
**Status**: Active

---

## 目的

停滞要因（手触り調整の難しさ、既知バグ、QAループの信頼性不足）を解消し、  
「継続的に改善できる開発状態」に戻したうえで完成まで到達する。

---

## 現状診断（2026-02-08）

### 事実確認

- `cargo test` は通過（ユニットテストは健全）
- `headless_sim -c debug` は60秒タイムアウトしやすい
- `trace_narrator` のショット統計が0になるケースがある
- アクティブタスク（`1_todo/2_in-progress/3_in-review`）が空で、運用が停止状態

### 主要課題

1. サーブ着地点の境界計算不整合（既知バグ）
2. レット判定のイベント設計/実行条件の不整合（既知バグ）
3. トレース設定と分析ツールの前提不一致（shot統計欠落）
4. QAの完了条件とゲーム設定のミスマッチ（長時間化しやすい）

---

## 完成定義（Definition of Done）

以下を満たした時点を「完成到達ライン」とする。

1. Criticalバグ0件（backlog起点の未修正Criticalを解消）
2. QA debug設定で完走率が安定（タイムアウト常態化を解消）
3. `trace_narrator` でショット統計が常時取得できる
4. 変更後に `cargo test` とヘッドレスQAが再現可能な手順で回る
5. タスク運用が `todo -> in-progress -> in-review -> archive` に復帰している

---

## フェーズ計画

## Phase 1: クリティカル修正（1-2日）

### 対象

- B30-001: サーブ着地点Zバグ
- B30-002: レット判定でポイント加算される問題
- B30-004: shot_attributesトレース設定
- 付随修正: rally_count統計欠落

### 完了条件

- 上記4点がコード/設定/テストで反映される
- `cargo test` 通過
- `headless_sim -c debug` の観測値が修正意図と一致

---

## Phase 2: QAループ信頼性回復（1日）

### 対象

- QA実行手順の一本化（設定名運用、出力先、判定基準）
- debug/stressの役割分離
- レポートで確認すべきKPIを固定

### KPI例

- 完走率
- 平均ラリー数
- Fault内訳（DoubleFault/NetFault/Out）
- ショット統計取得率

### 完了条件

- 同じコマンドで比較可能なQA結果を継続取得できる

---

## Phase 3: 手触り調整（3-5日）

### 対象

- サーブ/ショット/AIのパラメータ調整
- 極端な失点パターン（DoubleFault偏重など）の抑制
- ラリー継続性とテンポのバランス調整

### 完了条件

- ラリー成立率と試合進行テンポが目標範囲に入る
- 主要KPIの悪化が再発しない

---

## Phase 4: 仕上げ（2-3日）

### 対象

- 回帰確認（テスト + QA）
- ドキュメント更新（仕様/設定/運用）
- backlog整理とアーカイブ

### 完了条件

- リリース候補相当の安定性
- 開発再開時に迷わない状態（手順・判断基準が明文化）

---

## 実行順（優先順位）

1. まず観測を壊している不整合（B30-001/002/004 + rally_count）を直す  
2. 次にQA判定の前提を揃える  
3. 最後に手触り調整へ入る

> 方針: 「調整」より先に「観測系の信頼性」を回復する。

---

## 直近スプリント（最初の1週間）

### Day 1-2

- Phase 1実装
- 回帰テスト追加

### Day 3

- QAループ整備
- KPI基準値を固定

### Day 4-5

- 手触り調整（1サイクル目）
- QA比較レポート作成

---

## リスクと対策

1. **調整沼（パラメータだけいじり続ける）**  
   対策: KPI未定義の調整を禁止し、毎回QA比較を取る

2. **仕様と実装の再乖離**  
   対策: 変更ごとに対象仕様ファイルを更新、REQ対応を残す

3. **運用停止の再発**  
   対策: backlog起点で必ず `1_todo` へ昇格してから着手する

---

## 変更履歴

### 2026-02-08 - v1.0.0

- 初版作成
- 停滞要因に対応した4フェーズ計画を定義

