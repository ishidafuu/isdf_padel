# インゲーム機能 - Overview

**Version**: 2.0.0
**Last Updated**: 2026-01-09
**Status**: Draft

---

## 概要

このディレクトリは **インゲーム機能**（試合中のゲームプレイ）に関する仕様を管理します。

テニスゲームの**試合中**に発生する全ての挙動・ロジック・システムを定義します。

---

## スコープ

### 含む機能

- **試合進行**: サーブ → ラリー → 得点 → 次のポイント
- **プレイヤー操作**: 移動、ジャンプ、ショット
- **AI対戦相手**: ボール追跡、返球判断
- **ボール物理**: 軌道、地面バウンド、アウト判定、キャラクター当たり判定
- **コート**: オープンコート、境界判定
- **ショットシステム**: 打球方向、強さ、ジャンプショット
- **スコアリング**: ポイント判定、ゲーム/セット進行

### 含まない機能（4_outgameで管理）

- タイトル画面
- モード選択画面
- 試合結果画面
- メニューシステム

---

## フォルダ構成

```
3_ingame/
├── 30000_overview.md       # このファイル（全体像）
├── 301_match/              # 試合進行システム
├── 302_player/             # プレイヤー操作
├── 303_ai/                 # AI対戦相手
├── 304_ball/               # ボール物理
├── 305_court/              # コート構造
├── 306_shot_system/        # ショットシステム
└── 307_scoring/            # スコアリングシステム
```

---

## 各フォルダの責務

### 301_match: 試合進行システム

**責務**: 試合全体のフロー管理

| 機能 | 説明 |
|------|------|
| 試合開始 | プレイヤー配置、初期化 |
| サーブ | サーブ権の管理、サーブ動作 |
| ラリー | ボールの打ち合い、ターン管理 |
| ポイント終了 | 得点判定、次のポイントへ移行 |
| 試合終了 | 勝敗判定、結果画面への遷移 |

**参考資料**:
- [ナムコテニス - Match画面](../9_reference/901_reference_game/screens/90103_match.md)

---

### 302_player: プレイヤー操作

**責務**: プレイヤーキャラクターの操作・挙動

| 機能 | 説明 |
|------|------|
| 3軸移動 | X軸（左右）、Y軸（高さ/ジャンプ）、Z軸（奥行き） |
| ジャンプ | Y軸方向の移動、重力、着地 |
| ショット入力 | Bボタンでショット、方向指定 |
| ふっとばし | ボールが当たった時の吹っ飛び挙動 |
| 操作不能時間 | ふっとばし中、無敵時間 |

**参考資料**:
- [ナムコテニス - Player Movement](../9_reference/901_reference_game/mechanics/90111_player_movement.md)

**Padel Actionの特徴**:
- **A=ジャンプ、B=ショット**（ナムコテニスとは異なる）
- **2.5D横視点**（Z軸が奥行き、無段階移動）
- **キャラクター当たり判定**（ボールがキャラクターに直接当たる）

---

### 303_ai: AI対戦相手

**責務**: コンピュータ対戦相手の思考・行動

| 機能 | 説明 |
|------|------|
| ボール追跡 | ボールの軌道予測、移動判断 |
| 返球判断 | ショットタイミング、種類選択 |
| ポジショニング | コート内での位置取り |
| 難易度調整 | 移動速度、反応速度、ミス率 |

**参考資料**:
- [ナムコテニス - AI Behavior](../9_reference/901_reference_game/mechanics/90115_ai_behavior.md)

**MVP v0.1の範囲**:
- シンプルな追跡AI（ボールを追いかけて返球するだけ）
- 難易度調整は v0.2 以降

---

### 304_ball: ボール物理

**責務**: ボールの移動・衝突・軌道

| 機能 | 説明 |
|------|------|
| 軌道計算 | 3D空間での放物線運動 |
| 地面バウンド | 重力による落下、地面でのバウンド |
| アウト判定 | コート外着地で失点 |
| キャラクター当たり判定 | ボールとキャラクターの衝突判定 |
| ふっとばし発生 | 当たり判定時のイベント発行 |

**参考資料**:
- [ナムコテニス - Ball Physics](../9_reference/901_reference_game/mechanics/90113_ball_physics.md)

**テニスゲームの特徴**:
- **オープンコート**（壁・天井なし、アウト判定あり）
- **キャラクター当たり判定**（ボールがキャラクターに当たる）
- **スピン軌道影響**（v0.3で実装済み）

---

### 305_court: コート構造

**責務**: コートの構造・境界定義

| 機能 | 説明 |
|------|------|
| コートサイズ | 約10m x 6m（オープンコート） |
| アウト境界 | サイドライン、ベースライン |
| ネット | 中央に配置 |
| 境界判定 | X/Z軸の範囲制限 |
| 視覚表現 | Godot Sceneでの描画 |

**参考資料**:
- [Concept - Court Structure](../1_project/10001_concept.md#court-structure)

**テニスゲームの特徴**:
- **オープンコート**（壁・天井なし）
- **2.5D横視点**（Z軸が奥行き）

---

### 306_shot_system: ショットシステム

**責務**: ボールを打つ操作・ロジック

| 機能 | 説明 |
|------|------|
| ショット入力 | Bボタン、方向指定（十字キー） |
| ジャンプショット | ジャンプ中のショット（Y軸位置考慮） |
| 打球方向計算 | 入力方向 → ボール初速度ベクトル |
| 打球強さ | ボタン押下時間（v0.2以降） |
| タイミング判定 | ボールとの距離、許容範囲 |

**参考資料**:
- [ナムコテニス - Shot System](../9_reference/901_reference_game/mechanics/90112_shot_system.md)

**Padel Actionの特徴**:
- **ジャンプショット**（Y軸位置に応じて軌道変化）
- **必殺ショット**（v0.2以降、適切な高さで打つことで発生）

---

### 307_scoring: スコアリングシステム

**責務**: ポイント・ゲーム・セットの管理

| 機能 | 説明 |
|------|------|
| ポイント判定 | アウト、ネット、タイムアウト |
| ポイント進行 | 0→15→30→40→Game |
| ゲーム獲得 | 4点先取（2点差以上） |
| デュース処理 | 40-40時の処理 |
| セット進行 | 6ゲーム先取（MVP v0.1では1セットマッチ） |

**参考資料**:
- [ナムコテニス - Scoring](../9_reference/901_reference_game/mechanics/90114_scoring.md)

**MVP v0.1の範囲**:
- ポイント制（0→15→30→40→Game）
- 1セットマッチのみ
- デュースは v0.2 以降

---

## MVP v0.1の範囲（重要）

MVP v0.1では、**基本的なラリーが成立すること**を目標とします。

### ✅ 含む機能

| フォルダ | 含む機能 |
|---------|---------|
| 301_match | サーブ→ラリー→得点の基本フロー |
| 302_player | 3軸移動、ジャンプ、ショット、ふっとばし |
| 303_ai | ショット属性対応AI、難易度調整 |
| 304_ball | 地面バウンド、アウト判定、スピン軌道影響 |
| 305_court | オープンコート、境界判定 |
| 306_shot_system | ショット属性システム（5要素）、スピン |
| 307_scoring | ポイント進行、ゲーム獲得、1セットマッチ |

### ❌ 含まない機能（v0.4以降）

- 必殺ショット
- デュース処理
- タイブレーク
- ダブルス対応
- 複数セット
- チェンジコート
- アニメーション（簡易表示のみ）

---

## 次のステップ

1. ✅ 3_ingame全体の構造決定（このドキュメント）
2. ⏳ 各フォルダの詳細仕様策定（301～307）
3. ⏳ MVP v0.1の機能絞り込み
4. ⏳ データ定義（8_data/）の更新
5. ⏳ 実装開始

---

## 参考資料

- [10001_concept.md](../1_project/10001_concept.md) - ゲームコンセプト
- [20000_overview.md](../2_architecture/20000_overview.md) - アーキテクチャ概要
- [9_reference/901_reference_game/](../9_reference/901_reference_game/) - ナムコテニス参考資料

---

## Change Log

### 2026-01-09 - v2.0.0

- テニスゲームへの変更を反映
- パデル→テニス表記修正
- 壁・天井反射→オープンコート/アウト判定に変更
- v0.2/v0.3実装済み機能を含む機能に追加
- 含まない機能をv0.4以降に変更

### 2025-12-23 - v1.0.0（初版）

- 3_ingame全体の構造定義
- 各フォルダ（301～307）の責務明確化
- MVP v0.1の範囲設定
