# MVP v0.1 スコープ定義

**Version**: 1.0.0
**Last Updated**: 2025-12-23
**Status**: Draft

---

## 目的

MVP v0.1では、**基本的なラリーが成立すること**を目標とします。

最小限の機能で、プレイヤーとAIが対戦し、1セットマッチが完了するまでを実装します。

---

## 完成定義（Definition of Done）

以下の条件を全て満たすことをMVP v0.1の完成とします：

### 🎯 ゲームプレイ

- [ ] プレイヤーが3軸（X/Y/Z）で移動できる
- [ ] プレイヤーがジャンプできる（Aボタン）
- [ ] プレイヤーがショットできる（Bボタン）
- [ ] ボールが壁・天井で反射する
- [ ] ボールがキャラクターに当たるとふっとばしが発生する
- [ ] AIがボールを追いかけて返球する
- [ ] ラリーが成立する（打ち合いができる）
- [ ] ポイントが正しくカウントされる（0→15→30→40→Game）
- [ ] 1セットマッチが完了する（6ゲーム先取）
- [ ] 試合終了後、結果が表示される

### 🛠️ 技術要件

- [ ] ECSアーキテクチャで実装されている
- [ ] 全てのパラメータが外部データ化されている（ハードコーディングなし）
- [ ] イベントシステムで Entity 間通信している
- [ ] 深度レンダリング（Z-Index）が正しく動作する
- [ ] Godot Sceneで視覚表現されている

### 📝 ドキュメント要件

- [ ] 各機能の仕様書（spec.md）が作成されている
- [ ] データ定義（8_data/80101_game_constants.md）が作成されている
- [ ] 実装に `@spec` コメントが付与されている

---

## 含む機能（✅）

### 301_match: 試合進行

| 機能 | 説明 |
|------|------|
| 試合開始 | プレイヤー配置、スコア初期化 |
| サーブ | 手動サーブ（プレイヤーがBボタンでサーブ） |
| ラリー | ボールの打ち合い |
| ポイント終了 | 得点判定、次のポイントへ移行 |
| 試合終了 | 1セットマッチの勝敗判定 |

### 302_player: プレイヤー操作

| 機能 | 説明 |
|------|------|
| 3軸移動 | X軸（左右）、Y軸（高さ）、Z軸（奥行き） |
| ジャンプ | Aボタン、重力、着地 |
| ショット | Bボタン、方向指定（十字キー） |
| ジャンプショット | ジャンプ中のショット |
| ふっとばし | ボールが当たった時の吹っ飛び、操作不能時間 |

### 303_ai: AI対戦相手

| 機能 | 説明 |
|------|------|
| シンプルなボール追跡 | ボールの位置に向かって移動 |
| 基本的な返球 | ボールが近づいたらショット |
| 固定難易度 | 中級程度（調整なし） |

### 304_ball: ボール物理

| 機能 | 説明 |
|------|------|
| 3D軌道 | X/Y/Z軸での放物線運動 |
| 壁・天井反射 | 4面の壁 + 天井、全て反射する |
| キャラクター当たり判定 | ボールがキャラクターに当たる |
| コート判定 | アウト/イン判定 |
| ふっとばしイベント | BallHitEvent発行 |

### 305_court: コート構造

| 機能 | 説明 |
|------|------|
| コートサイズ定義 | 約10m x 20m |
| 4面の壁 | 左右、前後の壁、反射判定 |
| 天井 | 反射判定（アウトではない） |
| 境界判定 | プレイヤー移動制限、ボール反射 |
| 簡易な視覚表現 | シンプルなSprite/Mesh |

### 306_shot_system: ショットシステム

| 機能 | 説明 |
|------|------|
| 基本ショット | Bボタン、方向指定（十字キー） |
| ジャンプショット | ジャンプ中のショット |
| タイミング判定 | ボールが近くにある時のみショット可能 |
| 打球方向計算 | 入力方向 → ボール初速度ベクトル |

### 307_scoring: スコアリング

| 機能 | 説明 |
|------|------|
| ポイント進行 | 0→15→30→40→Game |
| ゲーム獲得 | 4点先取（デュースなし） |
| セット獲得 | 6ゲーム先取（1セットマッチ） |
| 勝敗判定 | 1セット獲得で勝利 |

### 309_referee: 審判システム

| 機能 | 説明 |
|------|------|
| 得点判定 | アウト、ツーバウンド、ネットイン判定 |
| フォールト判定 | サーブエリア外、ダブルフォルト |
| サーブ権管理 | サーブ権の初期化、交代、デュース/アドサイド判定 |

---

## 含まない機能（❌ v0.2以降）

### 301_match

- ❌ 自動サーブ
- ❌ サーブ失敗（フォルト、ダブルフォルト）
- ❌ チェンジコート
- ❌ 複数セット（3セット、5セットマッチ）

### 302_player

- ❌ ダッシュ
- ❌ 必殺ショット（Shot Systemで管理）
- ❌ アニメーション（簡易表示のみ）
- ❌ スタミナ

### 303_ai

- ❌ 軌道予測
- ❌ 戦略的配球
- ❌ 難易度調整（初級/中級/上級）
- ❌ 学習機能

### 304_ball

- ❌ スピン
- ❌ ボール間衝突
- ❌ 特殊な反射（摩擦、スライド）
- ❌ ボールエフェクト

### 305_court

- ❌ ネット（パデルルールでは不要だが、要検討）
- ❌ 詳細なテクスチャ
- ❌ ライティング
- ❌ エフェクト

### 306_shot_system

- ❌ 必殺ショット
- ❌ ボタン長押し（打球強さ調整）
- ❌ スピン
- ❌ ショット種類（ロブ、スマッシュ、ドロップショット）

### 307_scoring

- ❌ デュース処理
- ❌ タイブレーク
- ❌ 複数セット

### 309_referee

- ❌ フット・フォルト判定
- ❌ レット時のFault継続
- ❌ タッチネット判定
- ❌ キャラクター当たり判定（失点）
- ❌ タイブレーク時のサーブ権管理

---

## データ定義（参考値）

以下は**参考値**です。実装時は必ず `8_data/80101_game_constants.md` に定義し、`config.*` を参照してください。

### Player

| パラメータ | デフォルト値（参考） |
|-----------|------------------|
| 移動速度 | 5.0 m/s |
| ジャンプ力 | 10.0 m/s |
| ふっとばし速度 | 8.0 m/s |
| 無敵時間 | 1.5秒 |
| コリジョン半径 | 0.5 m |

### Ball

| パラメータ | デフォルト値（参考） |
|-----------|------------------|
| ボール半径 | 0.2 m |
| バウンド係数 | 0.8 |
| 通常ショット速度 | 15.0 m/s |
| ジャンプショット速度 | 18.0 m/s |
| 重力 | -9.8 m/s² |

### Court

| パラメータ | デフォルト値（参考） |
|-----------|------------------|
| 左端 | -10.0 m |
| 右端 | +10.0 m |
| 手前端 | 0.0 m |
| 奥端 | 10.0 m |
| 天井高さ | 6.0 m |

### Shot

| パラメータ | デフォルト値（参考） |
|-----------|------------------|
| 打球可能距離 | 1.5 m |
| 通常打球角度 | 45度 |
| ジャンプ打球角度 | 30度 |
| クールダウン時間 | 0.5秒 |

### AI

| パラメータ | デフォルト値（参考） |
|-----------|------------------|
| 移動速度 | 5.0 m/s |
| ショットクールダウン | 0.5秒 |

### Scoring

| パラメータ | デフォルト値（参考） |
|-----------|------------------|
| ゲーム獲得ポイント数 | 4点 |
| セット獲得ゲーム数 | 6ゲーム |
| マッチセット数 | 1セット |

---

## 実装順序（推奨）

以下の順序で実装することを推奨します：

### Phase 1: 基礎システム

1. **Court構造**（305_court）
   - コートサイズ定義
   - Godot Sceneの作成
   - 境界判定

2. **Player移動**（302_player）
   - 3軸移動
   - ジャンプ、重力、着地
   - 境界判定

3. **Ball物理**（304_ball）
   - 3D軌道
   - 重力
   - 壁・天井反射

### Phase 2: ゲームプレイ

4. **Shot System**（306_shot_system）
   - 基本ショット
   - タイミング判定
   - 打球方向計算

5. **ラリー成立**
   - プレイヤーがボールを打てる
   - ボールが壁で反射する
   - 打ち合いができる

6. **キャラクター当たり判定**（304_ball）
   - ボールがキャラクターに当たる
   - ふっとばし発生

### Phase 3: AI & スコア

7. **AI追跡**（303_ai）
   - ボール追跡
   - 基本的な返球

8. **Scoring**（307_scoring）
   - ポイント進行
   - ゲーム/セット管理

9. **Match Flow**（301_match）
   - 試合開始
   - サーブ
   - ポイント終了
   - 試合終了

### Phase 4: 統合テスト

10. **統合テスト**
    - 完成定義の確認
    - バグ修正
    - バランス調整

---

## 実装対象REQ-ID一覧（MVP v0.1）

以下のREQ-IDがMVP v0.1の実装対象です。各spec.mdの「Core Requirements (MVP v0.1)」セクションに対応します。

### 301_match: 試合進行

| ファイル | REQ-ID範囲 | 要件数 |
|---------|-----------|-------|
| 30101_flow_spec.md | REQ-30101-001 ~ 005 | 5 |
| 30102_serve_spec.md | REQ-30102-001 ~ 004 | 4 |
| 30103_point_end_spec.md | REQ-30103-001 ~ 004 | 4 |

**v0.2以降**: REQ-30101-050 ~, REQ-30102-050 ~, REQ-30103-050 ~

### 302_player: プレイヤー操作

| ファイル | REQ-ID範囲 | 要件数 |
|---------|-----------|-------|
| 30201_movement_spec.md | REQ-30201-001 ~ 006 | 6 |
| 30202_jump_spec.md | REQ-30202-001 ~ 005 | 5 |
| 30203_knockback_spec.md | REQ-30203-001 ~ 005 | 5 |

**v0.2以降**: REQ-30201-050 ~, REQ-30202-050 ~, REQ-30203-050 ~

### 303_ai: AI対戦相手

| ファイル | REQ-ID範囲 | 要件数 |
|---------|-----------|-------|
| 30301_movement_spec.md | REQ-30301-001 ~ 004 | 4（未作成） |
| 30302_shot_spec.md | REQ-30302-001 ~ 003 | 3（未作成） |

**v0.2以降**: REQ-30301-050 ~, REQ-30302-050 ~

### 304_ball: ボール物理

| ファイル | REQ-ID範囲 | 要件数 |
|---------|-----------|-------|
| 30401_trajectory_spec.md | REQ-30401-001 ~ 005 | 5 |
| 30402_reflection_spec.md | REQ-30402-001 ~ 006 | 6 |
| 30403_collision_spec.md | REQ-30403-001 ~ 006 | 6 |

**v0.2以降**: REQ-30401-050 ~, REQ-30402-050 ~, REQ-30403-050 ~

### 305_court: コート構造

| ファイル | REQ-ID範囲 | 要件数 |
|---------|-----------|-------|
| 30501_court_spec.md | REQ-30501-001 ~ 007 | 7 |

**v0.2以降**: REQ-30501-050 ~ 052
**v0.3以降**: REQ-30501-100 ~ 102

### 306_shot_system: ショットシステム

| ファイル | REQ-ID範囲 | 要件数 |
|---------|-----------|-------|
| 30601_shot_input_spec.md | REQ-30601-001 ~ 006 | 6 |
| 30602_shot_direction_spec.md | REQ-30602-001 ~ 004 | 4 |
| 30603_jump_shot_spec.md | REQ-30603-001 ~ 003 | 3 |

**v0.2以降**: REQ-30601-050 ~, REQ-30602-050 ~, REQ-30603-050 ~

### 307_scoring: スコアリング

| ファイル | REQ-ID範囲 | 要件数 |
|---------|-----------|-------|
| 30701_point_spec.md | REQ-30701-001 ~ 005 | 5 |
| 30702_game_spec.md | REQ-30702-001 ~ 004 | 4 |
| 30703_set_spec.md | REQ-30703-001 ~ 003 | 3 |

**v0.2以降**: REQ-30701-050 ~, REQ-30702-050 ~, REQ-30703-050 ~

### 309_referee: 審判システム

| ファイル | REQ-ID範囲 | 要件数 |
|---------|-----------|-------|
| 30901_point_judgment_spec.md | REQ-30901-001 ~ 004 | 4 |
| 30902_fault_spec.md | REQ-30902-001 ~ 003 | 3 |
| 30903_serve_authority_spec.md | REQ-30903-001 ~ 003 | 3 |

**v0.2以降**: REQ-30901-050 ~, REQ-30902-050 ~, REQ-30903-050 ~

---

## ID番号の慣習

| REQ-ID範囲 | 用途 |
|-----------|------|
| 001-049 | MVP v0.1 |
| 050-099 | v0.2 |
| 100-149 | v0.3+ |

**注意**: この範囲は厳密なルールではなく、柔軟に調整可能です。ID不足時は柔軟に対応してください。

---

## 実装時の注意事項

### ハードコーディング禁止

**CRITICAL**: 調整可能な全てのパラメータ値はハードコーディングを禁止し、外部データファイル化を必須とします。

```csharp
// ❌ 禁止
velocity.Y += -9.8f * deltaTime;

// ✅ 必須
velocity.Y += config.Physics.Gravity * deltaTime;
```

### 実装コメント必須

全ての実装に `@spec` コメントを付与してください。

```csharp
// @spec 30201_movement_spec.md#移動速度
velocity.X = input.X * config.Player.MoveSpeed;
```

### イベント駆動

Entity 間の直接参照を禁止し、EventSystemを使用してください。

```csharp
// ❌ 禁止
player.Knockback();

// ✅ 推奨
eventBus.Publish(new BallHitEvent { ... });
```

---

## 次のステップ

1. ✅ MVP v0.1のスコープ定義（このドキュメント）
2. ⏳ データ定義の作成（8_data/80101_game_constants.md）
3. ⏳ 各機能の詳細仕様策定（30101, 30201, ...）
4. ⏳ 実装開始（Phase 1から順次）

---

## 参考資料

- [30000_overview.md](30000_overview.md) - 3_ingame全体の概要
- [10001_concept.md](../1_project/10001_concept.md) - ゲームコンセプト
- [20000_overview.md](../2_architecture/20000_overview.md) - アーキテクチャ概要

---

## Change Log

### 2025-12-23 - v1.0.0（初版）

- MVP v0.1のスコープ定義
- 完成定義（Definition of Done）
- 含む機能・含まない機能の明確化
- データ定義（参考値）
- 実装順序の推奨
