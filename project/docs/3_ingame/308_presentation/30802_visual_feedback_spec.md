# Visual Feedback Specification

**Version**: 1.0.0
**Status**: Draft
**Last Updated**: 2026-01-08

## 概要

ショット属性システムの状態を視覚的にフィードバックする仕様を定義します。

プレイヤーの構え状態（ホールド中）とボールのスピン量・回転方向を視覚的に表示することで、ゲームの状態を直感的に理解できるようにします。

---

## コンセプト

### 設計思想

- **状態の可視化**: 内部的な計算結果を視覚的にフィードバック
- **直感的な理解**: 色・サイズ変化で状態を即座に把握
- **デバッグ支援**: v0.2統合テスト・バランス調整の判断材料

### 視覚フィードバック一覧

```
┌─────────────────────────────────────────────────────────────┐
│                    視覚フィードバック                        │
├─────────────────────────────────────────────────────────────┤
│ 1. プレイヤー構え表示: ホールド中にスプライト色変化         │
│ 2. ボールスピン表示: スピン量・方向に応じたボール色変化     │
└─────────────────────────────────────────────────────────────┘
```

---

## Core Requirements (v0.2)

### プレイヤー構え表示

#### REQ-30802-001: ホールド状態の視覚化

**WHEN** プレイヤーがショットボタンを押し続けている
**THE SYSTEM SHALL** プレイヤーのスプライト色を変化させる
- 通常時: 元のスプライト色
- ホールド中: オレンジ系の色にブレンド

**視覚効果**:
- ホールド開始: 即座に色変化開始
- ホールド継続: 時間経過で色が濃くなる
- ボタンリリース: 即座に元の色に戻る

**データ**: config.visual_feedback.hold_color (デフォルト: オレンジ)

---

#### REQ-30802-002: ホールド強度の視覚化

**WHEN** プレイヤーがショットボタンを押し続けている
**THE SYSTEM SHALL** ホールド時間に応じて色の濃さを変化させる

| ホールド時間 | 色ブレンド率 | 説明 |
|-------------|-------------|------|
| 0ms | 0.0 | 構え開始（元色） |
| 100ms | 0.5 | 構え中（半透明オレンジ） |
| 200ms+ | 1.0 | 構え完了（完全オレンジ） |

```
blend_ratio = min(1.0, hold_time / hold_stable_time)
display_color = lerp(original_color, hold_color, blend_ratio)
```

**データ**: config.shot_attributes.hold_stable_time を参照

---

### ボールスピン表示

#### REQ-30802-003: スピン量による色変化

**WHEN** ボールにスピン属性が設定されている
**THE SYSTEM SHALL** スピン量に応じてボールの色を変化させる

| スピン値 | 色 | 説明 |
|---------|-----|------|
| +1.0 | 赤 | 強トップスピン |
| +0.5 | オレンジ | 中トップスピン |
| 0.0 | 黄色 | ニュートラル |
| -0.5 | 水色 | 中スライス |
| -1.0 | 青 | 強スライス |

**色補間**: スピン値に応じて線形補間
- 正のスピン（トップ）: 黄色 → オレンジ → 赤
- 負のスピン（スライス）: 黄色 → 水色 → 青

**データ**:
- config.visual_feedback.ball_color_topspin (デフォルト: 赤)
- config.visual_feedback.ball_color_neutral (デフォルト: 黄)
- config.visual_feedback.ball_color_slice (デフォルト: 青)

---

#### REQ-30802-004: ショット時のスピン反映

**WHEN** ショットが実行される
**THE SYSTEM SHALL** 計算されたスピン属性をボールに設定する
- ShotAttributes.spin をボールコンポーネントに保存
- 色更新システムが毎フレームボールの色を更新

---

#### REQ-30802-005: ボール色更新システム

**THE SYSTEM SHALL** 毎フレーム以下を実行する
1. Ball コンポーネントからスピン値を取得
2. スピン値に応じた色を計算
3. Sprite.color を更新

**パフォーマンス考慮**:
- スピン値が変化していない場合は更新をスキップ

---

## Extended Requirements (v0.3+)

### REQ-30802-050: 構えアニメーション

**WHEN** プレイヤーがホールド状態
**THE SYSTEM SHALL** 専用の構えアニメーションを再生する
- ラケットを引く動作
- 体を後ろに反らす

---

### REQ-30802-051: ボールスピンエフェクト

**WHEN** ボールにスピンがかかっている
**THE SYSTEM SHALL** 回転を示すパーティクルエフェクトを表示する
- トップスピン: 上方向に流れるパーティクル
- スライス: 横方向に流れるパーティクル

---

### REQ-30802-052: 威力ゲージ表示

**WHEN** プレイヤーがショット可能な位置にいる
**THE SYSTEM SHALL** 予測威力をゲージで表示する
- 5要素から計算される威力の可視化

---

## 制約（Design by Contract）

### 事前条件

- GameConfig が読み込まれている
- Player/Ball Entity が存在する
- ShotButtonState リソースが存在する

### 事後条件

- プレイヤーの色がホールド状態を反映する
- ボールの色がスピン状態を反映する

### 不変条件

- 色変化は即座に反映される（1フレーム以内）
- ゲームロジックには影響しない（純粋な視覚表現）

---

## データ参照

### 視覚フィードバックパラメータ

| パラメータ | データ定義 | デフォルト値 |
|-----------|-----------|------------|
| ホールド色 | config.visual_feedback.hold_color | (1.0, 0.5, 0.0, 1.0) |
| トップスピン色 | config.visual_feedback.ball_color_topspin | (1.0, 0.2, 0.2, 1.0) |
| ニュートラル色 | config.visual_feedback.ball_color_neutral | (0.9, 0.9, 0.2, 1.0) |
| スライス色 | config.visual_feedback.ball_color_slice | (0.2, 0.4, 1.0, 1.0) |

詳細: [80101_game_constants.md](../../8_data/80101_game_constants.md)

---

## 依存関係

### 依存先

- [30604_shot_attributes_spec.md](../306_shot_system/30604_shot_attributes_spec.md) - スピン属性
- [80101_game_constants.md](../../8_data/80101_game_constants.md) - パラメータ定義

### 依存元

- なし（純粋な視覚表現）

---

## 備考

### 目的

- v0.2統合テスト時の動作確認を容易にする
- プレイヤーがショット属性を理解しやすくする
- 将来のエフェクト実装の基盤となる

### 調整ポイント

- 色の選択は視認性とゲーム雰囲気のバランスを考慮
- ホールド時の色変化速度は config.shot_attributes.hold_stable_time と連動

---

## Change Log

### 2026-01-08 - v1.0.0（初版）

- プレイヤー構え表示の仕様
- ボールスピン色変化の仕様
