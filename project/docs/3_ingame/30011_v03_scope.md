# v0.3 スコープ定義

**Version**: 1.0.0
**Last Updated**: 2026-01-08
**Status**: Draft

---

## 目的

v0.3では、**スピンによる軌道変化**を実現し、テニス/パデルらしい「球種の違い」を表現します。

v0.2の「ショット属性システム」で計算されたスピン値を、実際の軌道・バウンド挙動に反映させます。

---

## 完成定義（Definition of Done）

以下の条件を全て満たすことをv0.3の完成とします：

### スピン軌道影響

- [ ] トップスピン（spin > 0）でボールが早く落ちる
- [ ] スライス（spin < 0）でボールが浮く
- [ ] バウンド時にスピンに応じた挙動変化がある
  - [ ] トップスピン: 低く伸びる
  - [ ] スライス: 高く止まる
- [ ] スピンによる空気抵抗が適用される
- [ ] スピン効果が時間経過で減衰する

### 視覚確認

- [ ] トップスピン（赤）が早く落下する
- [ ] スライス（青）が浮いて飛ぶ
- [ ] バウンド後の挙動がスピンに応じて変化する

### 技術要件

- [ ] 全パラメータが外部データ化されている（SpinPhysicsConfig）
- [ ] 単体テストが全て通過する

---

## 含む機能（v0.3）

### 304_ball: スピン軌道影響（強化）

| 機能 | 説明 | REQ-ID |
|------|------|--------|
| 重力変動 | スピンに応じて実効重力を変動 | REQ-30401-100 |
| スピン時間減衰 | 飛行中にスピン効果が減衰 | REQ-30401-101 |
| 空気抵抗 | スピン絶対値に応じた減速 | REQ-30401-102 |
| バウンド挙動変化 | スピンに応じた水平/垂直バウンド係数 | REQ-30402-100 |

### パラメータ設定

| パラメータ | デフォルト | 説明 |
|-----------|----------|------|
| gravity_spin_factor | 0.3 | 重力変動割合（±30%） |
| bounce_spin_horizontal_factor | 0.3 | 水平バウンド変動 |
| bounce_spin_vertical_factor | 0.2 | 垂直バウンド変動 |
| base_air_drag | 0.0 | ベース空気抵抗 |
| spin_drag_factor | 0.3 | スピン空気抵抗 |
| spin_decay_rate | 0.5 | スピン減衰率/秒 |

---

## 含まない機能（v0.4以降）

### エフェクト関連

- ❌ 軌道エフェクト（REQ-30401-150）
- ❌ 反射エフェクト（REQ-30402-150）
- ❌ スピンの視覚エフェクト（回転表現）

### ルール関連

- ❌ デュース処理
- ❌ タイブレーク
- ❌ チェンジコート

---

## 実装フェーズ

### Phase 1: パラメータ追加

1. `config.rs`: SpinPhysicsConfig構造体追加
2. `game_config.ron`: パラメータ値追加
3. `GameConfig`: spin_physicsフィールド追加

### Phase 2: システム修正

1. `ball_gravity_system`: BallSpin参照追加、重力変動計算
2. `ball_ground_bounce_system`: スピン考慮のバウンド計算

### Phase 3: システム追加

1. `ball_air_drag_system`: 空気抵抗（新規）
2. `ball_spin_decay_system`: スピン減衰（新規）

### Phase 4: テスト

1. 単体テスト追加（TST-30404-100〜106）
2. 統合テスト・視覚確認

---

## 修正対象ファイル

| ファイル | 変更内容 |
|---------|---------|
| `project/src/resource/config.rs` | SpinPhysicsConfig追加 |
| `project/assets/config/game_config.ron` | パラメータ追加 |
| `project/src/systems/ball_trajectory.rs` | 4システム修正/追加 |

---

## テスト項目

### 単体テスト

| テストID | テスト名 | 検証内容 |
|----------|---------|---------|
| TST-30404-100 | test_gravity_with_topspin | spin=+1.0時、重力が130%になる |
| TST-30404-101 | test_gravity_with_slice | spin=-1.0時、重力が70%になる |
| TST-30404-102 | test_spin_decay | 1秒後にスピンが50%減衰する |
| TST-30404-103 | test_bounce_with_topspin | トップスピン時、水平維持率上昇・垂直低下 |
| TST-30404-104 | test_bounce_with_slice | スライス時、水平維持率低下・垂直上昇 |
| TST-30404-105 | test_air_drag_with_spin | スピン絶対値に応じた減速 |
| TST-30404-106 | test_spin_neutral | spin=0時、基準値で動作 |

---

## 関連ドキュメント

- [30401_trajectory_spec.md](304_ball/30401_trajectory_spec.md) - ボール軌道仕様
- [30402_reflection_spec.md](304_ball/30402_reflection_spec.md) - ボール反射仕様
- [80101_game_constants.md](../8_data/80101_game_constants.md#spin-physics-config) - SpinPhysicsConfig

---

## 備考

- v0.2で実装済みのスピン視覚化（ボール色変更）はそのまま使用
- スピン値の計算ロジック（shot_attributes.rs）は変更なし
- 壁反射時のスピン挙動変化はv0.3では含まない（地面バウンドのみ）
