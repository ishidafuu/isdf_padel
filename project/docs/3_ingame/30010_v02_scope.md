# v0.2 スコープ定義

**Version**: 1.0.0
**Last Updated**: 2026-01-07
**Status**: Draft

---

## 目的

v0.2では、**テニス/パデルとしてのショットの打ち分け**を実現し、**1人で遊べるAI**を実装します。

v0.1の「基本的なラリー成立」から、「状況に応じたショットの変化」と「対戦相手としてのAI」へ進化させます。

---

## 完成定義（Definition of Done）

以下の条件を全て満たすことをv0.2の完成とします：

### ショットシステム

- [ ] 5要素によるショット属性の無段階変化が動作する
  - [ ] 入力方式（プッシュ精度/ホールド時間）
  - [ ] 打点の高さ（Z座標）
  - [ ] バウンド経過時間
  - [ ] ボールへの入り方（移動ベクトル）
  - [ ] ボールとの距離
- [ ] 属性（威力、安定性、角度、スピン、精度）が計算される
- [ ] 属性に応じてボールの軌道が変化する
- [ ] ホールドの「構え」が視覚的にわかる

### AIシステム

- [ ] AIがショット属性システムを使用する
- [ ] AIが状況に応じたポジショニングをする
- [ ] AIの難易度調整パラメータがある
- [ ] 1人プレイとして成立する

### 技術要件

- [ ] 全パラメータが外部データ化されている
- [ ] カーブ係数がキャラ別に設定可能な構造になっている（将来対応）

---

## 含む機能（v0.2）

### 306_shot_system: ショット属性システム（新規）

| 機能 | 説明 |
|------|------|
| 5要素判定 | 入力方式、打点高さ、タイミング、入り方、距離 |
| 属性計算 | 威力、安定性、角度、スピン、精度の算出 |
| 無段階変化 | 連続値による滑らかな変化 |
| ホールド/プッシュ | 押しっぱなし vs タイミング合わせ |

### 303_ai: AI対戦相手（強化）

| 機能 | 説明 |
|------|------|
| 状況判断 | ボール軌道予測、ポジショニング |
| ショット選択 | 5要素を考慮したショット実行 |
| 難易度パラメータ | 反応速度、判断精度の調整 |
| ホールド読み | 相手の構えを見て予測（将来） |

---

## 含まない機能（v0.3以降）

### ショット関連

- ❌ 必殺ショット（特殊演出）
- ❌ キャラ別カーブ係数（構造のみ準備）
- ❌ スピンの視覚エフェクト

### ルール関連

- ❌ デュース処理
- ❌ タイブレーク
- ❌ チェンジコート
- ❌ 複数セット

### その他

- ❌ ダッシュ（不要：テニスは常にダッシュ）
- ❌ アニメーション詳細化
- ❌ 演出・エフェクト強化

---

## 実装順序（推奨）

### Phase 1: ショット属性システム基盤

1. **ショット属性コンポーネント設計**
   - ShotContext: 5要素の入力値を保持
   - ShotAttributes: 計算された属性値を保持

2. **5要素の取得システム**
   - 入力方式判定（プッシュ/ホールド、精度/時間）
   - 打点高さ取得（Z座標）
   - バウンド経過時間取得
   - 移動ベクトル・ボール方向の内積計算
   - ボールとの距離計算

3. **属性計算システム**
   - 各要素 → 係数変換（リニア）
   - 係数の乗算による最終属性算出

### Phase 2: ショット実行への反映

4. **ボール軌道への反映**
   - 威力 → 初速度
   - 角度 → 発射角度
   - スピン → 軌道カーブ（簡易版）
   - 精度 → ブレ量

5. **安定性システム**
   - 安定性が低い → ミスショット発生
   - ミスショットの挙動定義

### Phase 3: AI強化

6. **AI状況判断**
   - ボール軌道予測
   - 適切な打点への移動

7. **AIショット実行**
   - 5要素を考慮したショット
   - 難易度に応じた精度

### Phase 4: 統合・調整

8. **バランス調整**
   - 係数チューニング
   - AI難易度調整

---

## 5要素の詳細仕様

### 要素一覧

| # | 要素 | 入力値 | 影響属性 |
|---|------|-------|---------|
| 1 | 入力方式 | プッシュ精度(ms) / ホールド時間(ms) | 威力, 安定性 |
| 2 | 打点の高さ | Z座標(m) | 威力, 安定性, 角度 |
| 3 | バウンド経過時間 | バウンドからの時間(s) | 威力, 安定性, 角度 |
| 4 | ボールへの入り方 | 移動ベクトル・ボール方向の内積 | 威力, 角度 |
| 5 | ボールとの距離 | XY平面距離(m) | 威力, 安定性, 精度 |

### 出力属性

| 属性 | 説明 | 影響 |
|------|------|------|
| 威力 | ボールスピード係数 | 高い→速い |
| 安定性 | ミス確率係数 | 低い→ミスしやすい |
| 角度 | 発射角度補正 | 高い→上向き |
| スピン | 回転量 | +トップ/-スライス |
| 精度 | コースブレ係数 | 低い→ブレる |

### 詳細仕様

詳細は [30604_shot_attributes_spec.md](306_shot_system/30604_shot_attributes_spec.md) を参照。

---

## データ定義

v0.2で追加するパラメータ（参考値）：

### ショット属性

| パラメータ | デフォルト値 | 説明 |
|-----------|------------|------|
| プッシュ最大精度時間 | 50ms | これ以内でジャスト判定 |
| プッシュ→ホールド閾値 | 150ms | これ以上でホールド扱い |
| ホールド安定化時間 | 200ms | これ以上で安定性頭打ち |
| 最適打点高さ | 1.0m | 最も安定する高さ |
| 最適ボール距離 | 1.0m | 最も威力が出る距離 |

### AI

| パラメータ | デフォルト値 | 説明 |
|-----------|------------|------|
| 反応遅延 | 100ms | ボール認識の遅れ |
| 予測精度 | 0.8 | 軌道予測の正確さ |
| ショット精度 | 0.7 | タイミング合わせの正確さ |

---

## 実装対象REQ-ID一覧（v0.2）

### 306_shot_system: ショット属性システム

| ファイル | REQ-ID範囲 | 要件数 |
|---------|-----------|-------|
| 30604_shot_attributes_spec.md | REQ-30604-050 ~ 070 | 新規作成 |

### 303_ai: AI強化

| ファイル | REQ-ID範囲 | 要件数 |
|---------|-----------|-------|
| 30301_ai_movement_spec.md | REQ-30301-050 ~ | 追加 |
| 30302_ai_shot_spec.md | REQ-30302-050 ~ | 追加 |

---

## 参考資料

- [30009_mvp_scope.md](30009_mvp_scope.md) - MVP v0.1スコープ
- [30600_overview.md](306_shot_system/30600_overview.md) - ショットシステム概要
- [10001_concept.md](../1_project/10001_concept.md) - ゲームコンセプト

---

## Change Log

### 2026-01-07 - v1.0.0（初版）

- v0.2スコープ定義
- 5要素ショット属性システムの仕様
- AI強化の方向性定義
