# Court Specification

**Version**: 2.1.0
**Status**: Draft
**Last Updated**: 2026-01-09

## 概要

テニスのコート構造を定義します。コートはオープンコート（壁・天井なし）であり、コート外に落ちたボールはアウトとなります。

## Core Requirements (MVP v0.1)

### REQ-30501-001: コート座標系
**WHEN** システムが初期化される
**THE SYSTEM SHALL** コートの3D座標系を以下のように定義する
- X軸: 打ち合い方向（-X: 1Pコート側、+X: 2Pコート側）← 画面の左右
- Y軸: 高さ方向（0: 地面、+Y: 上）
- Z軸: コート幅方向（-Z: 左、+Z: 右）← 画面の上下に合成

**参照**: なし（独自定義）
**テスト**: TST-30504-001

---

### REQ-30501-002: コート境界（サイドライン・コート幅方向）
**WHEN** コート境界を判定する
**THE SYSTEM SHALL** コートのサイドライン（コート幅方向）を以下の座標で定義する
- 左端: Z = `-config.Court.Width / 2` (デフォルト: -5.0m)
- 右端: Z = `+config.Court.Width / 2` (デフォルト: +5.0m)

**データ**: [80101_game_constants.md](../../8_data/80101_game_constants.md#court-config)
**テスト**: TST-30504-002
**備考**: サイドライン外に落ちたボールはアウト（REQ-30501-007参照）

---

### REQ-30501-003: コート境界（ベースライン・打ち合い方向）
**WHEN** コート境界を判定する
**THE SYSTEM SHALL** コートのベースライン（打ち合い方向）を以下の座標で定義する
- 後端（1Pコート側）: X = `-config.Court.Depth / 2` (デフォルト: -3.0m)
- 後端（2Pコート側）: X = `+config.Court.Depth / 2` (デフォルト: +3.0m)

**データ**: [80101_game_constants.md](../../8_data/80101_game_constants.md#court-config)
**テスト**: TST-30504-003
**備考**: ベースライン外に落ちたボールはアウト（REQ-30501-007参照）

---

### REQ-30501-005: ネット位置
**WHEN** コート境界を判定する
**THE SYSTEM SHALL** ネットをコート中央に配置する
- ネットX座標: X = 0（コート中央、1P/2Pの境界）
- ネットZ方向: Z軸に沿って配置（コート幅方向に伸びる）
- ネット高さ: Y = 0.88m（テニス規格）

**参照**: テニス規格
**テスト**: TST-30504-005

---

### REQ-30501-006: コート区分（1P/2P）
**WHEN** ボールまたはプレイヤーの位置を判定する
**THE SYSTEM SHALL** コートを1Pコートと2Pコートに区分する
- 1Pコート範囲: X < 0（ネットより手前、画面左側）
- 2Pコート範囲: X >= 0（ネット含む、画面右側）

**テスト**: TST-30504-006

---

### REQ-30501-007: アウト境界
**WHEN** ボールがコート外に着地する
**THE SYSTEM SHALL** アウト判定を行う
- サイドアウト（コート幅方向）: |Z| > `config.Court.Width / 2`
- ベースラインアウト（打ち合い方向）: |X| > `config.Court.Depth / 2`

**備考**: アウト判定は着地位置で判定（空中は対象外）
**参照**: テニスルール
**テスト**: TST-30504-007

---

### REQ-30501-008: サービスライン描画
**WHEN** コートが描画される
**THE SYSTEM SHALL** サービスライン（サービスボックスの境界線）を描画する
- サービスライン位置（1P側）: X = `-config.Court.ServiceBoxDepth` (デフォルト: -1.5m)
- サービスライン位置（2P側）: X = `+config.Court.ServiceBoxDepth` (デフォルト: +1.5m)
- センターサービスライン: Z = 0（ネットからサービスラインまでの中央線、コート幅方向）
- 線の色: 白
- 線の太さ: コート境界線と同様

**データ**: [80101_game_constants.md](../../8_data/80101_game_constants.md#court-config)
**テスト**: TST-30504-008
**備考**: サービスボックスはサーブ着地判定（REQ-30902-001）で使用される

---

## Extended Requirements (v0.2)

### REQ-30501-050: ネット衝突判定
**WHEN** ボールがネットに接触する
**THE SYSTEM SHALL** ボールとネットの衝突を判定する
- ネット位置: X = `config.Court.NetX` (デフォルト: 0.0m)
- ネット高さ: Y < `config.Court.NetHeight` (デフォルト: 0.88m)
- 衝突時: ボールは反射せず、ネットを越えた側に失点

**データ**: [80101_game_constants.md](../../8_data/80101_game_constants.md#court-config)
**テスト**: TST-30504-050

---

### REQ-30501-051: コート表面タイプ
**WHEN** ゲーム設定でコート表面タイプを選択する
**THE SYSTEM SHALL** コート表面タイプに応じてボール物理パラメータを変更する
- ハードコート: デフォルトの反射係数
- クレイコート: 反射係数減少、摩擦増加
- グラスコート: 反射係数増加、摩擦減少

**データ**: 新規 `config.Court.SurfaceType`
**テスト**: TST-30504-051

---

### REQ-30501-052: 環境照明
**WHEN** コートが描画される
**THE SYSTEM SHALL** 環境照明を設定する
- 昼間: 明るい照明、影あり
- 夜間: ナイター照明、強い影
- 室内: 均一照明、影なし

**データ**: 新規 `config.Court.LightingMode`
**テスト**: TST-30504-052

---

## Future Requirements (v0.3+)

### REQ-30501-100: 観客席・背景
**WHEN** コートが描画される
**THE SYSTEM SHALL** 観客席と背景を描画する
- 観客席: コート周囲に配置
- 背景: スタジアム、屋外、室内などのバリエーション
- アニメーション: 観客の歓声、動き

**データ**: 新規 `config.Court.BackgroundType`
**テスト**: TST-30504-100

---

### REQ-30501-101: 環境音
**WHEN** ゲームプレイ中
**THE SYSTEM SHALL** 環境音を再生する
- ボール音: 地面バウンド音、ラケット打球音
- 観客音: 歓声、拍手
- 環境音: 風、鳥の鳴き声（屋外の場合）

**データ**: 新規 `config.Audio.EnvironmentalSounds`
**テスト**: TST-30504-101

---

### REQ-30501-102: 天候システム
**WHEN** 屋外コートでゲームプレイ中
**THE SYSTEM SHALL** 天候システムを適用する
- 晴れ: デフォルト
- 雨: ボール速度減少、滑りやすい
- 風: ボール軌道に影響

**データ**: 新規 `config.Court.WeatherType`
**テスト**: TST-30504-102

---

## 制約（Design by Contract）

### 事前条件
- `config.Court.Width > 0`
- `config.Court.Depth > 0`
- ネット高さ > 0

### 事後条件
- 全てのゲームオブジェクト（Player, Ball）はコート座標系内またはアウト判定可能な位置に配置される
- ネットはコート中央（X=0, Z=0）に配置される

### 不変条件
- コート座標系は変更されない（試合中不変）
- ネット位置は変更されない（試合中不変）

---

## データ参照

| パラメータ | データソース | デフォルト値 |
|----------|------------|------------|
| Court.Width | config.Court.Width | 10.0m |
| Court.Depth | config.Court.Depth | 6.0m |

詳細: [80101_game_constants.md](../../8_data/80101_game_constants.md#court-config)

---

## 依存関係

### 依存先
- [80101_game_constants.md](../../8_data/80101_game_constants.md) - ゲーム定数定義

### 依存元
- [30503_boundary_behavior.md](30503_boundary_behavior.md) - 境界判定動作（コート区分を参照）
- [30901_point_judgment_spec.md](../309_referee/30901_point_judgment_spec.md) - アウト判定

---

## 備考

### テニスの特徴
- オープンコート（壁・天井なし）
- コート外に落ちたボールはアウト（打った側の失点）
- ネットを越えて相手コートに入れる必要がある

### 座標系の方向
- X軸の正方向（+X）が2Pコート側（画面右側）
- Z軸はコート幅方向（-Z: 画面奥、+Z: 画面手前に相当）
- プレイヤーは通常、自コート側からネット方向（X=0）に向かってボールを打つ

---

## Change Log

### 2026-01-09 - v2.1.0（座標系定義を実装に統一）

- **REQ-30501-001**: 座標系定義を実装に合わせて修正（X軸: 打ち合い方向、Z軸: コート幅方向）
- **REQ-30501-002**: サイドラインをZ軸で定義
- **REQ-30501-003**: ベースラインをX軸で定義
- **REQ-30501-005**: ネット位置の説明を修正
- **REQ-30501-006**: コート区分をX軸基準に修正
- **REQ-30501-007**: アウト境界の軸を修正
- **REQ-30501-008**: サービスライン位置をX軸に修正
- **REQ-30501-050**: ネット衝突判定のX座標参照を修正
- **備考**: 座標系の方向説明を更新

### 2026-01-08 - v2.0.0（テニスへ変更）

- **コート構造**: 密閉空間（壁・天井あり） → オープンコート（壁・天井なし）
- **REQ-30501-004（天井）**: 削除
- **REQ-30501-007**: 「アウトの不存在」→「アウト境界」に変更
- **依存関係**: 30502_wall_design.md への依存を削除
- **備考**: パデルからテニスへの変更に伴う全面改訂

### 2025-12-23 - v1.0.0（初版）

- 初版作成（パデルベース）
