---
id: "F050"
title: "タスク完了時ステータス遷移修正"
type: "framework"
status: "done"
priority: "high"
spec_ids: []
blocked_by: []
blocks: []
branch_name: null
worktree_path: null
plan_file: "/Users/ishidafuu/.claude/plans/stateful-wibbling-dream.md"
tags: ["task-management", "bugfix"]
created_at: "2026-01-08T12:00:00+09:00"
updated_at: "2026-01-08T12:00:00+09:00"
completed_at: "2026-01-08T18:00:00+09:00"
---

# Task F050: タスク完了時ステータス遷移修正

## 説明

タスク完了時に InReview を経由せず直接 Done になってしまう問題を修正する。
3つのドキュメント間で責務と強制力を明確化し、game-dev タスクの in-review 経由を必須化する。

## 背景

### 現状

- game-dev タスク（30XXX/B30XXX/R30XXX）は in-review を経由して完了すべき
- 現状、in-progress から直接 done に遷移してしまうことがある
- ドキュメント上では「CRITICAL」と記載されているが、強制力が不足

### 改修理由

- impl-agent.md: スキップ条件（FXXX/PXXX）が先頭にあり、必須処理が埋もれている
- task-manager-agent.md: 前提条件チェックが「MANDATORY」として強制されていない
- task-operations.md: 前提条件チェックが例示的で、必須として明示されていない

## 実装内容

- [x] `.claude/agents/impl-agent.md` の「実装完了後のハンドオフ」セクションを修正
  - game-dev タスクの必須処理を先頭に移動
  - スキップ条件（FXXX/PXXX）を末尾に移動
  - 「MANDATORY」キーワードを追加
- [x] `.claude/agents/task-manager-agent.md` の前提条件チェックを強化
  - 「MANDATORY」として明示
  - エラー時の処理中断を明確化
- [x] `.claude/skills/task-operations.md` の前提条件チェックを必須化
  - 「推奨」から「必須」に変更
  - exit 1 で処理中断を明示

## 完了チェックリスト

- [x] 変更内容の検証完了
- [x] ドキュメント整合性確認

## メモ

- FXXX/PXXX タスクは従来通り直接 done（変更なし）
- game-dev タスクのみ in-review 経由を強制

## 依存関係

- **ブロック**: なし
- **ブロックされる**: なし
- **関連ドキュメント**:
  - `.claude/agents/impl-agent.md`
  - `.claude/agents/task-manager-agent.md`
  - `.claude/skills/task-operations.md`

---

## Detailed Implementation Plan

以下は、プランファイル `/Users/ishidafuu/.claude/plans/stateful-wibbling-dream.md` の全内容です。

# タスク完了時のステータス遷移修正プラン

## 問題

タスク完了時に InReview を経由せず直接 Done になってしまう。

## 根本原因

3つのドキュメント間で責務と強制力が曖昧：

1. **impl-agent.md**: in-review 遷移の説明がスキップ条件（FXXX/PXXX）で始まり、game-dev タスクの必須処理が埋もれている
2. **task-manager-agent.md**: 前提条件チェックが記載されているが「MANDATORY」として強制されていない
3. **task-operations.md**: 前提条件チェックが例示的で、必須として明示されていない

## 修正方針

**アプローチ**: 3ファイルを修正し、責務と強制力を明確化

### 修正 1: `.claude/agents/impl-agent.md`

**場所**: 524-557行目「実装完了後のハンドオフ（CRITICAL）」セクション

**変更内容**:
- セクション冒頭で game-dev タスクの必須処理を先に記載
- スキップ条件（FXXX/PXXX）は末尾に移動
- 「MANDATORY」キーワードを追加
- チェックリスト形式で明確化

### 修正 2: `.claude/agents/task-manager-agent.md`

**場所**: 315-354行目「2. タスク完了フロー」セクション

**変更内容**:
- 前提条件チェックを「MANDATORY」として強化
- チェック失敗時のエラーメッセージを明確化
- 処理フローを条件分岐で明確化

### 修正 3: `.claude/skills/task-operations.md`

**場所**: 114-142行目「4. タスク完了」セクション

**変更内容**:
- セクションタイトルを「MANDATORY」に変更
- チェック失敗時の処理を明確化
- チェック対象タスクタイプを明確化

## 修正対象ファイル

| ファイル | 修正内容 |
|---------|---------|
| `.claude/agents/impl-agent.md` | in-review 遷移を MANDATORY として明確化 |
| `.claude/agents/task-manager-agent.md` | 前提条件チェックを MANDATORY として強化 |
| `.claude/skills/task-operations.md` | 前提条件チェックを必須として位置づけ |

## 期待される効果

1. **impl-agent**: game-dev タスク完了時に in-review 遷移を必ず実行
2. **task-manager-agent**: in-review 以外からの完了処理をエラーで中断
3. **task-operations.md**: 処理フローが明確になり、誤った実装を防止

## 検証方法

修正後、以下を確認:
1. game-dev タスク完了時に in-review を経由するか
2. in-progress から直接 done にしようとするとエラーになるか
3. FXXX/PXXX タスクは従来通り直接 done になるか
