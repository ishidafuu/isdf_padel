---
id: "F038"
title: "タスクレビューフェーズ遷移の明確化"
type: "framework"
status: "done"
priority: "high"
spec_ids: []
blocked_by: []
blocks: []
branch_name: null
worktree_path: null
plan_file: "~/.claude/plans/mighty-whistling-waterfall.md"
tags: ["task-management", "review", "state-transition"]
parent_task_id: null
created_at: "2026-01-07T12:00:00+09:00"
updated_at: "2026-01-07T12:00:00+09:00"
completed_at: "2026-01-07T13:00:00+09:00"
---

# Task F038: タスクレビューフェーズ遷移の明確化

## Summary

タスク30010が `in-progress` → 直接 `done(archive)` に移動し、`in-review` フェーズがスキップされた問題を修正する。

**根本原因**: `in-progress` → `in-review` の状態遷移を誰が責務を持って実行するのか、どの処理ガイドラインにも明示的に記載されていない。

## Related Specifications

- `.claude/skills/task-lifecycle.md` - タスク状態遷移定義
- `.claude/skills/task-operations.md` - タスク操作定義

## Progress

### Completed

- [x] 問題の調査・根本原因特定
- [x] 修正方針決定

### In Progress

- [x] impl-agent.md に「実装完了後のハンドオフ」セクション追加
- [x] review-agent.md に「前提条件」と「レビュー完了後の処理」追加
- [x] task-manager-agent.md に「タスク状態遷移フロー」セクション追加
- [x] task-operations.md に「レビュー開始操作」セクション追加

## Next Actions

1. impl-agent.md に「実装完了後のハンドオフ」セクション追加
2. review-agent.md に「前提条件」と「レビュー完了後の処理」追加
3. task-manager-agent.md に「タスク状態遷移フロー」セクション追加
4. task-operations.md に「レビュー開始操作」セクション追加

## Dependencies

- **Blocked By:** なし
- **Blocks:** なし

## Detailed Implementation Plan

### 決定事項

1. **対象範囲**: game-dev タスク（30XXX）のみ in-review 必須
   - FXXX/PXXX は `in-progress` → 直接 `done` 可能

2. **例外規定**: なし（常に必須）
   - game-dev タスクは軽微な変更でも必ず in-review を経由する

### 修正対象ファイル

| ファイル | 追加内容 |
|---------|---------|
| `.claude/agents/impl-agent.md` | 実装完了後のハンドオフ（in-progress → in-review 遷移） |
| `.claude/agents/review-agent.md` | 前提条件（タスクは3_in-review/にあること）、完了後処理 |
| `.claude/agents/task-manager-agent.md` | タスク状態遷移フロー（レビュー開始・完了） |
| `.claude/skills/task-operations.md` | レビュー開始操作セクション |

### 修正内容詳細

#### 1. impl-agent.md

```markdown
## 実装完了後のハンドオフ（CRITICAL）

**game-dev タスク（30XXX）のみ適用**

実装・テスト完了後、以下の流れで review-agent に引き継ぐ：

1. **実装完了を確認**（テスト全パス、コンパイル成功）
2. **タスク状態を `in-review` に遷移**
   - ファイル移動: `2_in-progress/` → `3_in-review/`
   - Frontmatter: `status: "in-progress"` → `status: "in-review"`
3. **review-agent でレビューを実施**
4. **レビュー完了後に task-manager-agent がタスク完了処理を実行**

**注意**: 実装完了 → 直接 done は禁止。必ず in-review を経由する。
```

#### 2. review-agent.md

```markdown
## 前提条件（CRITICAL）

review-agent が呼び出される前に、タスクは `3_in-review/` に移動済みであること。

**タスク状態遷移の責務（game-dev のみ）**:
- `in-progress` → `in-review`: impl-agent 完了時に実行
- `in-review` → `done`: review-agent 完了後に task-manager-agent が実行

## レビュー完了後の処理

1. **問題なし**: task-manager-agent でタスク完了処理を実行
2. **問題あり**: impl-agent に差し戻し（`3_in-review/` → `2_in-progress/`）
```

#### 3. task-manager-agent.md

```markdown
### タスク状態遷移フロー（game-dev のみ）

#### A. レビュー開始（in-progress → in-review）

impl-agent から引き継ぎ後：

1. タスクファイルを移動: `project/tasks/2_in-progress/` → `project/tasks/3_in-review/`
2. Frontmatter 更新: `status: "in-progress"` → `status: "in-review"`

#### B. タスク完了（in-review → done）

review-agent から引き継ぎ後：

1. タスクファイルを移動: `project/tasks/3_in-review/` → `project/tasks/4_archive/`
2. Frontmatter 更新: `status: "in-review"` → `status: "done"`
```

#### 4. task-operations.md

「レビュー開始操作」セクションを既存の「タスク完了」セクションの前に追加。

## メモ

- FXXX/PXXX タスクは in-review をスキップ可能（worktree非対応のため簡略フロー）
- game-dev タスクは軽微な変更でも必ず in-review を経由
