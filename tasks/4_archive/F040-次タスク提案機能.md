---
id: "F040"
title: "次タスク提案機能"
type: "framework"
status: "done"
priority: "medium"
spec_ids: []
blocked_by: []
blocks: []
branch_name: null
worktree_path: null
plan_file: "/Users/ishidafuu/.claude/plans/lazy-growing-orbit.md"
tags: ["task-management", "ux"]
created_at: "2026-01-07T11:00:00+09:00"
updated_at: "2026-01-07T12:30:00+09:00"
completed_at: "2026-01-07T12:30:00+09:00"
---

# Task F040: 次タスク提案機能

## 説明

タスク完了時に自動で「次に着手可能なタスク」を表示し、いつでもコマンドで呼び出せる機能を追加する。

## 背景

### 現状

- タスク完了後、次に何を着手できるか手動で確認が必要
- 依存関係を考慮した着手可能タスクの把握が煩雑

### 改修理由

- タスク完了時に自動で次のアクションを提示し、作業効率を向上
- 並列実行可能なタスクを明示し、並列開発を促進

## 実装内容

- [x] `.claude/commands/task-next.md` を新規作成
- [x] `.claude/skills/task-lifecycle.md` に自動表示セクションを追記
- [x] `.claude/skills/task-operations.md` に判定ロジックを追記
- [x] `.claude/commands/README.md` にコマンド一覧を追記

## 依存関係

- **ブロック**: なし
- **ブロックされる**: なし
- **関連ドキュメント**:
  - `.claude/skills/task-status.md`（アイコン定義）
  - `.claude/skills/task-lifecycle.md`（タスク状態遷移）

## メモ

- 対象範囲: `project/tasks/` のみ（30XXX/PXXX）
- 既存のアイコン定義を使用（🔴 high / 🟡 medium / 🟢 low）

---

## Detailed Implementation Plan

以下は、プランファイル `~/.claude/plans/lazy-growing-orbit.md` の全内容です。

# 次タスク提案機能（/task-next）実装プラン

## 概要

タスク完了時に自動で「次に着手可能なタスク」を表示し、いつでもコマンドで呼び出せる機能を追加。

## 要件

- **表示タイミング**: 両方（タスク完了時に自動表示 + コマンドでいつでも呼び出し可能）
- **対象範囲**: `project/tasks/` のみ（30XXX/PXXX）

## 実装内容

### 1. 新規作成: `.claude/commands/task-next.md`

```markdown
---
description: 次に着手可能なタスクを提案 (project)
argument-hint: [--limit <N>]
---
```

**処理フロー:**
1. Glob で `project/tasks/1_todo/*.md` を取得
2. Glob で `project/tasks/4_archive/*.md` を取得（完了済みID収集）
3. Glob で `project/tasks/2_in-progress/*.md`, `3_in-review/*.md` を取得（進行中）
4. 各todoタスクの `blocked_by` を確認、全依存が完了済みなら READY
5. 進行中タスクとの相互依存を確認して並列可能判定
6. 優先度・ブロック解除数でソート

**出力形式:**
```
次に着手可能なタスク (N件):

🔴 ⬜ [30013] ポイント進行
   └─ Blocks: 30014, 30016, 30018, 30021 (4件解除)
   └─ 並列: ✅ 可能

🟡 ⬜ [30012] ジャンプショット
   └─ Blocks: なし
   └─ 並列: ✅ 可能

---
推奨: 30013（ポイント進行）を先に実装すると4タスクが着手可能になります
```

### 2. 追記: `.claude/skills/task-lifecycle.md`

「タスク完了時の次タスク提案」セクションを追加:

```markdown
## タスク完了時の次タスク提案（AUTOMATIC）

タスクを `done` に遷移させた後、自動的に `/task-next` を実行。

### 出力形式

✅ タスク 30010（ショット入力）を完了しました

---
🔓 新たに着手可能になったタスク:

🔴 ⬜ [30012] ジャンプショット
   └─ Blocks: なし
   └─ 並列: ✅ 可能
```

### 3. 追記: `.claude/skills/task-operations.md`

依存解消判定ロジックを追加:

```markdown
## 次タスク判定

### 着手可能判定（isReady）
blocked_by の全タスクが 4_archive/ に存在し status: "done"

### 並列実行可能判定（canParallel）
進行中タスクと相互に blocked_by/blocks が含まれないか確認

### ソート順
1. priority: high > medium > low
2. blocks.length: 多い順（ブロック解除インパクト大）
3. id: 小さい順
```

### 4. 追記: `.claude/commands/README.md`

「🔀 共用コマンド」セクションに追加:

```markdown
| `/task-next [--limit <N>]` | 次タスクを確認 | タスク完了時に自動実行 |
```

## 変更ファイル一覧

| ファイル | 操作 |
|---------|------|
| `.claude/commands/task-next.md` | **新規作成** |
| `.claude/skills/task-lifecycle.md` | 追記（セクション追加） |
| `.claude/skills/task-operations.md` | 追記（判定ロジック） |
| `.claude/commands/README.md` | 追記（コマンド一覧更新） |

## アイコン（既存定義を使用）

- 優先度: 🔴 high / 🟡 medium / 🟢 low
- ステータス: ⬜ todo / 🔄 in-progress
