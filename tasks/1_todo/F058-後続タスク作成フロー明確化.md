---
id: "F058"
title: "後続タスク作成フローの明確化"
type: "framework"
status: "todo"
priority: "medium"
related_task: null
spec_ids: []
blocked_by: []
blocks: []
branch_name: null
worktree_path: null
plan_file: "/Users/ishidafuu/.claude/plans/transient-beaming-lightning.md"
tags: ["task-management", "guideline"]
created_at: "2026-01-09T16:30:00+09:00"
updated_at: "2026-01-09T16:30:00+09:00"
completed_at: null
---

# Task F058: 後続タスク作成フローの明確化

## 説明

タスク作業中/完了時に後続タスクが必要になった場合、task-registration-agent 経由で作成することを必須化するガイドラインを追加する。

## 背景

### 現状

R30501-001 完了時に後続タスク（R30501-002, R30501-003）を task-registration-agent を経由せずに手動作成した結果：

- YAML frontmatter なしのファイルが生成
- task-next.py がタスクを認識できない
- タスク管理システムとの不整合

### 改修理由

後続タスク作成フローが未定義のため、手動でファイルを作成してしまった。明示的なガイドラインを追加して再発を防止する。

## 実装内容

### 対象ファイル

| ファイル | 追加位置 |
|---------|---------|
| `.claude/agents/task-manager-agent.md` | 357行目の後（タスク完了フローの後） |
| `.claude/skills/task-lifecycle.md` | 331行目の後（次タスク提案の後） |

### 1. task-manager-agent.md への追加

- [ ] 「2.1. 後続タスクの作成（CRITICAL）」セクションを追加
- [ ] 必須フロー（プランモード → task-registration-agent）を記載
- [ ] 禁止事項（手動作成、frontmatter なし）を明記

### 2. task-lifecycle.md への追加

- [ ] 「後続タスク作成ガイドライン（CRITICAL）」セクションを追加
- [ ] 発生シナリオ（リファクタ完了時、バグ修正完了時、機能実装中）を記載
- [ ] 禁止事項と理由を表形式で明記

## 完了チェックリスト

- [ ] 変更内容の検証完了
- [ ] ドキュメント整合性確認（task-manager-agent.md と task-lifecycle.md の記述が矛盾しないこと）

## メモ

なし

## 依存関係

- **ブロック**: なし
- **ブロックされる**: なし
- **関連ドキュメント**:
  - `.claude/agents/task-manager-agent.md`
  - `.claude/skills/task-lifecycle.md`
  - `.claude/agents/task-registration-agent.md`

---

## Detailed Implementation Plan

以下は、プランファイル `~/.claude/plans/transient-beaming-lightning.md` の全内容です。

# FXXX: 後続タスク作成フローの明確化

## Task Type

framework

## 概要

タスク作業中/完了時に後続タスクが必要になった場合、task-registration-agent 経由で作成することを必須化するガイドラインを追加する。

## 背景

### 現状の問題

R30501-001 完了時に後続タスク（R30501-002, R30501-003）を task-registration-agent を経由せずに手動作成した結果：

- YAML frontmatter なしのファイルが生成
- task-next.py がタスクを認識できない
- タスク管理システムとの不整合

### 原因

後続タスク作成フローが未定義のため、手動でファイルを作成してしまった。

## 改修内容

### 対象ファイル

| ファイル | 追加位置 |
|---------|---------|
| `.claude/agents/task-manager-agent.md` | 357行目の後（タスク完了フローの後） |
| `.claude/skills/task-lifecycle.md` | 331行目の後（次タスク提案の後） |

---

### 1. task-manager-agent.md への追加（357行目の後）

```markdown
### 2.1. 後続タスクの作成（CRITICAL）

タスク完了時または作業中に後続タスクが必要になった場合。

**必須フロー**: task-registration-agent ガイドライン経由で作成

```
後続タスクが必要
  ↓
プランモード開始（EnterPlanMode）
  ↓
プランファイル作成（~/.claude/plans/）
  ↓
「プランからタスクを作成して」
  ↓
task-registration-agent 経由でタスク作成
  ↓
frontmatter 付きタスクファイル生成
```

**禁止事項**:
- ❌ タスクファイルを直接手動作成
- ❌ frontmatter なしでのファイル生成
- ❌ task-registration-agent を経由しない作成

**理由**:
- task-next.py が frontmatter を必要とする
- 依存関係（blocked_by/blocks）の適切な設定
- ID 自動採番による重複防止
```

---

### 2. task-lifecycle.md への追加（331行目の後）

```markdown
---

## 後続タスク作成ガイドライン（CRITICAL）

タスク作業中または完了時に、関連する後続タスクが必要になることがある。

### 発生シナリオ

1. **リファクタタスク完了時** - 追加の改善タスクを発見
2. **バグ修正完了時** - 根本原因の修正が別タスクとして必要
3. **機能実装中** - 前提となる別機能の実装が必要

### 必須フロー

**すべてのタスク作成は task-registration-agent 経由で行う**

```
後続タスクが必要
  ↓
プランモード開始
  ↓
プランファイル作成
  ↓
「プランからタスクを作成して」と依頼
  ↓
task-registration-agent がタスク作成
```

### 禁止事項

| 禁止 | 理由 |
|------|------|
| タスクファイルの手動作成 | frontmatter 漏れの原因 |
| コピペでのタスクファイル複製 | ID 重複、依存関係ミス |
| task-registration-agent を経由しない作成 | タスク管理システムとの不整合 |
```

---

## 検証方法

1. **ドキュメント整合性確認**
   - task-manager-agent.md と task-lifecycle.md の記述が矛盾しないこと

2. **実際のワークフロー確認**
   - 新規 R タスクをプランモード経由で作成
   - frontmatter が正しく生成されることを確認
   - `python3 scripts/task-next.py` でタスクが認識されることを確認
