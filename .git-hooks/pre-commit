#!/bin/bash
# Pre-commit hook: æ¤œè¨¼ãƒ„ãƒ¼ãƒ«å®Ÿè¡Œ

echo "ğŸ” Running validation checks..."

# å¤‰æ›´ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–å¾—
CHANGED_MD=$(git diff --cached --name-only --diff-filter=ACM | grep '\.md$' || true)
CHANGED_CODE=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(cs|py|ts|js|gd)$' || true)

# ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ãŒå¤‰æ›´ã•ã‚Œã¦ã„ã‚‹å ´åˆ
if [ -n "$CHANGED_MD" ]; then
  echo "ğŸ“‹ Validating markdown files..."
  
  # IDæ¤œè¨¼
  python3 scripts/validate-ids.py --path docs/
  if [ $? -ne 0 ]; then
    echo ""
    echo "âŒ ID validation failed. Commit aborted."
    exit 1
  fi
  
  # ãƒªãƒ³ã‚¯æ¤œè¨¼
  python3 scripts/validate-links.py --path docs/
  if [ $? -ne 0 ]; then
    echo ""
    echo "âŒ Link validation failed. Commit aborted."
    exit 1
  fi
fi

# ã‚³ãƒ¼ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«ãŒå¤‰æ›´ã•ã‚Œã¦ã„ã‚‹å ´åˆ
if [ -n "$CHANGED_CODE" ] && [ -d "src/" ]; then
  echo "ğŸ’» Validating code files..."
  
  python3 scripts/validate-impl-comments.py --code-path src/ --docs-path docs/
  if [ $? -ne 0 ]; then
    echo ""
    echo "âŒ Implementation comment validation failed. Commit aborted."
    exit 1
  fi
fi

echo "âœ… All validation checks passed"
exit 0
